

================================================================================
FILE: ./manage.py
================================================================================

#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault("DJANGO_SETTINGS_MODULE", "authentication.settings")
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == "__main__":
    main()



================================================================================
FILE: ./requirements.txt
================================================================================

asgiref==3.10.0
Django==5.2.8
djangorestframework==3.16.1
phonenumbers==9.0.18
pillow==12.0.0
sqlparse==0.5.3


================================================================================
FILE: ./authentication.txt
================================================================================



================================================================================
FILE: ./export_project.py
================================================================================

import os

OUTPUT = "authentication.txt"

# Dossiers √† exclure
EXCLUDED_DIRS = {
    "venv", "__pycache__", ".git", "node_modules",
    "staticfiles", "media", "migrations"
}

# Extensions de fichiers √† exclure
EXCLUDED_EXT = {
    ".pyc", ".sqlite3", ".db", ".log"
}

def should_skip(file_path):
    # Exclure par extension
    _, ext = os.path.splitext(file_path)
    if ext in EXCLUDED_EXT:
        return True
    return False

with open(OUTPUT, "w", encoding="utf-8") as out:
    for root, dirs, files in os.walk("."):
        # Exclure les dossiers inutiles
        dirs[:] = [d for d in dirs if d not in EXCLUDED_DIRS]

        for file in files:
            full_path = os.path.join(root, file)

            # V√©rifier si on doit sauter le fichier
            if should_skip(full_path):
                continue

            out.write("\n\n" + "="*80 + "\n")
            out.write(f"FILE: {full_path}\n")
            out.write("="*80 + "\n\n")

            try:
                with open(full_path, "r", encoding="utf-8") as f:
                    out.write(f.read())
            except Exception as e:
                out.write(f"[ERREUR LECTURE FICHIER: {e}]\n")

print(f"‚úÖ Export termin√© ! Le fichier g√©n√©r√© est : {OUTPUT}")


================================================================================
FILE: ./django_authentication/backends.py
================================================================================

from django.contrib.auth import get_user_model
from django.contrib.auth.backends import ModelBackend

class CustomAuthBackend(ModelBackend):
    def get_user(self, user_id):
        User = get_user_model()
        try:
            return User.objects.get(pk=user_id)
        except User.DoesNotExist:
            return None

    def user_can_authenticate(self, user):
        return user.is_active

    def get_user_permissions(self, user_obj, obj=None):
        return set()

    def get_group_permissions(self, user_obj, obj=None):
        return set()

    def get_all_permissions(self, user_obj, obj=None):
        return set()

    def has_perm(self, user_obj, perm, obj=None):
        return user_obj.is_superuser

    def has_module_perms(self, user_obj, app_label):
        return user_obj.is_superuser


================================================================================
FILE: ./django_authentication/serializers.py
================================================================================

import json
from datetime import datetime
from django.core.serializers.json import DjangoJSONEncoder
from django.db import models

class CustomJSONEncoder(DjangoJSONEncoder):
    """S√©rialiseur JSON personnalis√© pour g√©rer les objets Django"""
    def default(self, obj):
        # Si l'objet a une m√©thode __json__, l'utiliser
        if hasattr(obj, '__json__'):
            return obj.__json__()
        # G√©rer les champs datetime
        elif isinstance(obj, datetime):
            return obj.isoformat()
        # G√©rer les mod√®les Django
        elif isinstance(obj, models.Model):
            # Retourner un dictionnaire avec les champs du mod√®le
            data = {}
            for field in obj._meta.fields:
                value = getattr(obj, field.name)
                # Appel r√©cursif pour g√©rer les relations
                if isinstance(value, models.Model):
                    data[field.name] = self.default(value)
                # G√©rer les champs ManyToMany
                elif field.many_to_many:
                    data[field.name] = [self.default(item) for item in value.all()]
                else:
                    data[field.name] = value
            return data
        return super().default(obj)

def dumps(obj, **kwargs):
    """Fonction utilitaire pour s√©rialiser des objets en JSON"""
    return json.dumps(obj, cls=CustomJSONEncoder, **kwargs)



================================================================================
FILE: ./django_authentication/session_serializer.py
================================================================================

import json
from django.core.serializers.json import DjangoJSONEncoder
from django.contrib.sessions.serializers import JSONSerializer
from .serializers import CustomJSONEncoder

class CustomSessionSerializer(JSONSerializer):
    """
    Serializer personnalis√© pour les sessions Django qui utilise notre CustomJSONEncoder.
    """
    def dumps(self, obj):
        return json.dumps(
            obj, separators=(',', ':'),
            cls=CustomJSONEncoder,
        ).encode('latin-1')





================================================================================
FILE: ./django_authentication/urls.py
================================================================================

from django.urls import path
from . import views

urlpatterns = [
    # Pages publiques
    path('', views.home_view, name='home'),
    path('signup/', views.signup_view, name='signup'),
    path('login/', views.login_view, name='login'),
    path('logout/', views.logout_view, name='logout'),
    path('reset-password/', views.reset_password_view, name='reset_password'),
    
    # Dashboards
    path('user-dashboard/', views.user_dashboard_view, name='user_dashboard'),
    path('superuser-dashboard/', views.superuser_dashboard_view, name='superuser_dashboard'),
    
    # Gestion des utilisateurs (admin) - URLs personnalis√©es
    path('gestion-utilisateurs/', views.user_management_list, name='user_management'),
    path('gestion-utilisateurs/creer/', views.user_create_view, name='user_create'),
    path('gestion-utilisateurs/<int:user_id>/modifier/', views.user_edit_view, name='user_edit'),
    path('gestion-utilisateurs/<int:user_id>/supprimer/', views.user_delete_view, name='user_delete'),
    path('gestion-utilisateurs/<int:user_id>/changer-statut/', views.user_toggle_status_view, name='user_toggle_status'),
    
    # Gestion des r√¥les (admin)
    path('gestion-roles/', views.manage_roles_view, name='manage_roles'),
    path('gestion-roles/creer/', views.role_create_view, name='role_create'),
    path('gestion-roles/<int:role_id>/modifier/', views.role_edit_view, name='role_edit'),
    path('gestion-roles/<int:role_id>/supprimer/', views.role_delete_view, name='role_delete'),
    
    # API endpoints
    path('api/profile/update/', views.update_profile_ajax, name='api_update_profile'),
    path('api/profile/delete-picture/', views.delete_profile_picture_ajax, name='api_delete_profile_picture'),
]

================================================================================
FILE: ./django_authentication/models.py
================================================================================

from django.db import models
from django.contrib.auth.hashers import make_password, check_password
from django.contrib.auth.models import BaseUserManager, AbstractBaseUser, PermissionsMixin
from django.core.validators import FileExtensionValidator
from django.utils.translation import gettext_lazy as _
import re
import os
from django.utils import timezone
from django.conf import settings
from django.core.exceptions import ValidationError

def user_profile_picture_path(instance, filename):
    """Chemin de stockage des photos de profil"""
    ext = filename.split('.')[-1]
    filename = f'user_{instance.id}_profile.{ext}'
    return os.path.join('profile_pictures', filename)


class UserManager(BaseUserManager):
    """Manager personnalis√© pour le mod√®le User"""
    
    def create_user(self, email, full_name, phone, password=None, **extra_fields):
        """Cr√©e et sauvegarde un utilisateur standard"""
        if not email:
            raise ValueError('L\'adresse email est obligatoire')
        
        email = self.normalize_email(email)
        role_name = extra_fields.pop('role', 'user')
        
        user = self.model(
            email=email,
            full_name=full_name,
            phone=phone,
            **extra_fields
        )
        user.set_password(password)
        user.save(using=self._db)
        return user
    
    def create_superuser(self, email, full_name, phone, password=None, **extra_fields):
        """
        Cr√©e et sauvegarde un superutilisateur avec le r√¥le 'superuser'.
        """
        from .models import Role
        
        # S'assurer que le r√¥le 'superuser' existe
        role, created = Role.objects.get_or_create(
            name='superuser',
            defaults={
                'display_name': 'Super Utilisateur',
                'is_default': False
            }
        )
        
        # D√©finir les attributs de superutilisateur
        extra_fields.update({
            'role': role,
            'is_staff': True,
            'is_superuser': True
        })
        
        # Cr√©er l'utilisateur avec tous les attributs
        user = self.model(
            email=self.normalize_email(email),
            full_name=full_name,
            phone=phone,
            **extra_fields
        )
        
        user.set_password(password)
        user.save(using=self._db)
        
        return user


class Role(models.Model):
    """Mod√®le pour g√©rer les r√¥les personnalis√©s"""
    name = models.CharField(
        _('nom du r√¥le'),
        max_length=50,
        unique=True,
        help_text=_('Nom unique du r√¥le (en minuscules, sans espaces, ex: editor, manager)')
    )
    display_name = models.CharField(
        _('nom d\'affichage'),
        max_length=100,
        help_text=_('Nom affich√© dans l\'interface')
    )
    is_default = models.BooleanField(
        _('r√¥le par d√©faut'),
        default=False,
        help_text=_('Si coch√©, ce r√¥le sera attribu√© par d√©faut aux nouveaux utilisateurs')
    )
    permissions = models.JSONField(
        _('permissions'),
        default=dict,
        blank=True,
        help_text=_('Dictionnaire JSON des permissions sp√©cifiques au r√¥le')
    )
    created_at = models.DateTimeField(_('date de cr√©ation'), auto_now_add=True)
    updated_at = models.DateTimeField(_('date de modification'), auto_now=True)

    class Meta:
        verbose_name = _('r√¥le')
        verbose_name_plural = _('r√¥les')
        ordering = ['name']

    def __str__(self):
        return self.display_name

    def clean(self):
        # S'assurer qu'il n'y a qu'un seul r√¥le par d√©faut
        if self.is_default:
            Role.objects.filter(is_default=True).exclude(pk=self.pk).update(is_default=False)

    def save(self, *args, **kwargs):
        # S'assurer que le nom est en minuscules et sans espaces
        self.name = self.name.lower().strip().replace(' ', '_')
        super().save(*args, **kwargs)
        
    def __json__(self):
        """S√©rialisation JSON personnalis√©e pour le mod√®le Role"""
        return {
            'id': self.id,
            'name': self.name,
            'display_name': self.display_name,
            'is_default': self.is_default,
            'permissions': self.permissions,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }

def is_system_role(self):
    """V√©rifie si le r√¥le est un r√¥le syst√®me (non supprimable)"""
    return self.name in ['user', 'superuser']

def user_count(self):
    """Retourne le nombre d'utilisateurs ayant ce r√¥le"""
    return self.users.count()

@classmethod
def get_system_roles(cls):
    """Retourne les r√¥les syst√®me"""
    return cls.objects.filter(name__in=['user', 'superuser'])

@classmethod
def get_custom_roles(cls):
    """Retourne les r√¥les personnalis√©s (non-syst√®me)"""
    return cls.objects.exclude(name__in=['user', 'superuser'])

class User(AbstractBaseUser, PermissionsMixin):
    """Mod√®le utilisateur personnalis√© avec validation compl√®te"""
    
    # R√¥les syst√®me pr√©d√©finis
    SYSTEM_ROLES = {
        'superuser': 'Super Utilisateur',
        'user': 'Utilisateur',
    }
    
    full_name = models.CharField(
        max_length=255,
        verbose_name="Nom complet",
        help_text="Format: Nom Pr√©nom(s) ou Nom_Pr√©nom(s) ou NomPr√©nom(s)"
    )
    email = models.EmailField(
        unique=True,
        verbose_name="Adresse e-mail",
        db_index=True
    )
    
    # Champs requis pour le mod√®le utilisateur personnalis√©
    is_staff = models.BooleanField(
        default=False,
        help_text='D√©termine si l\'utilisateur peut se connecter √† l\'interface d\'administration.',
    )
    is_active = models.BooleanField(
        default=True,
        help_text='D√©signe si cet utilisateur doit √™tre consid√©r√© comme actif. D√©s√©lectionnez ceci plut√¥t que de supprimer le compte.',
    )
    date_joined = models.DateTimeField(
        default=timezone.now,
        verbose_name="Date d'inscription"
    )
    phone = models.CharField(
        max_length=20,
        unique=True,
        verbose_name="Num√©ro de t√©l√©phone",
        db_index=True
    )
    password = models.CharField(
        max_length=255,
        verbose_name="Mot de passe"
    )
    profile_picture = models.ImageField(
        upload_to=user_profile_picture_path,
        null=True,
        blank=True,
        verbose_name="Photo de profil",
        validators=[
            FileExtensionValidator(
                allowed_extensions=['jpg', 'jpeg', 'png', 'gif', 'webp']
            )
        ],
        help_text="Formats accept√©s: JPG, JPEG, PNG, GIF, WEBP. Taille max: 5MB"
    )
    role = models.ForeignKey(
        Role,
        on_delete=models.PROTECT,
        verbose_name=_('r√¥le'),
        related_name='users',
        null=True,
        blank=True,
        help_text=_('R√¥le de l\'utilisateur dans le syst√®me')
    )
    # is_active est maintenant d√©fini plus haut avec plus d'options
    created_at = models.DateTimeField(
        auto_now_add=True,
        verbose_name="Date de cr√©ation"
    )
    updated_at = models.DateTimeField(
        auto_now=True,
        verbose_name="Date de modification"
    )
    
    objects = UserManager()
    
    # Champs requis pour compatibilit√© avec Django Admin
    USERNAME_FIELD = 'email'
    REQUIRED_FIELDS = ['full_name', 'phone']
    
    class Meta:
        db_table = 'users'
        verbose_name = 'Utilisateur'
        verbose_name_plural = 'Utilisateurs'
        ordering = ['-created_at']
        permissions = [
            ("can_manage_users", "Peut g√©rer les utilisateurs"),
            ("can_view_dashboard", "Peut voir le dashboard"),
        ]
    
    def __str__(self):
        return f"{self.full_name} ({self.email})"
    
    def set_password(self, raw_password):
        """Hash le mot de passe avant sauvegarde"""
        self.password = make_password(raw_password)
    
    def check_password(self, raw_password):
        """V√©rifie si le mot de passe correspond"""
        return check_password(raw_password, self.password)
    
    def get_initials(self):
        """G√©n√®re les initiales √† partir du nom complet"""
        # Nettoyer et diviser le nom complet
        parts = [p for p in re.split(r'[\s_]+', self.full_name.strip()) if p]
        
        # Si le nom complet est au format "Nom Prenom1 Prenom2"
        if len(parts) == 3 and all(part[0].isupper() for part in parts):
            return ''.join(part[0] for part in parts).upper()
        
        # Gestion des autres formats de noms
        if len(parts) >= 2:
            # Pour les noms avec pr√©noms multiples, on prend la premi√®re lettre de chaque partie
            return ''.join(part[0].upper() for part in parts[:3] if part)
        elif parts:
            # Si une seule partie, on prend les deux premiers caract√®res
            return parts[0][:2].upper()
        
        # Par d√©faut, retourner les deux premi√®res lettres de l'email
        return self.email[:2].upper() if self.email else 'US'
    
    def has_profile_picture(self):
        """V√©rifie si l'utilisateur a une photo de profil"""
        return bool(self.profile_picture and self.profile_picture.name)
    
    def get_profile_picture_url(self):
        """Retourne l'URL de la photo de profil ou None"""
        if self.has_profile_picture():
            try:
                return self.profile_picture.url
            except ValueError:
                return None
        return None
    
    def get_profile_picture_url_safe(self):
        """Alias pour get_profile_picture_url (compatibilit√©)"""
        return self.get_profile_picture_url()
    
    @property
    def is_superuser(self):
        """V√©rifie si l'utilisateur est un superuser"""
        if hasattr(self, '_is_superuser'):
            return self._is_superuser
        return self.role and self.role.name == 'superuser'
        
    @is_superuser.setter
    def is_superuser(self, value):
        """D√©finit si l'utilisateur est un superuser"""
        self._is_superuser = value
    
    @property
    def is_staff(self):
        """V√©rifie si l'utilisateur est staff (pour Django Admin)"""
        if hasattr(self, '_is_staff'):
            return self._is_staff
        return self.is_superuser  # Seuls les superusers ont acc√®s √† l'admin Django
        
    @is_staff.setter
    def is_staff(self, value):
        """D√©finit si l'utilisateur est staff"""
        self._is_staff = value
    
    def has_perm(self, perm, obj=None):
        """V√©rifie si l'utilisateur a une permission sp√©cifique"""
        if self.is_superuser:
            return True
            
        if not self.role:
            return False
            
        # V√©rifier les permissions personnalis√©es du r√¥le
        if isinstance(self.role.permissions, dict):
            # Gestion des permissions hi√©rarchiques (ex: 'app.view_model')
            parts = perm.split('.')
            for i in range(len(parts), 0, -1):
                check_perm = '.'.join(parts[:i])
                if check_perm in self.role.permissions.get('permissions', []):
                    return True
                    
        return super().has_perm(perm, obj)
    
    def has_module_perms(self, app_label):
        """V√©rifie si l'utilisateur a des permissions pour une application"""
        if self.is_superuser:
            return True
            
        if not self.role:
            return False
            
        # V√©rifier les permissions d'application du r√¥le
        if isinstance(self.role.permissions, dict):
            app_perms = self.role.permissions.get('app_permissions', [])
            if app_label in app_perms:
                return True
                
        return super().has_module_perms(app_label)
    
    def get_role_display(self):
        """Retourne le nom d'affichage du r√¥le"""
        if self.role:
            return self.role.display_name
        return _('Aucun r√¥le')
    
    @classmethod
    def get_default_role(cls):
        """Retourne le r√¥le par d√©faut"""
        try:
            return Role.objects.get(is_default=True)
        except (Role.DoesNotExist, Role.MultipleObjectsReturned):
            # En cas d'erreur, on essaie de r√©cup√©rer le r√¥le 'user'
            try:
                return Role.objects.get(name='user')
            except (Role.DoesNotExist, Role.MultipleObjectsReturned):
                # Si aucun r√¥le n'existe, on en cr√©e un par d√©faut
                return Role.objects.create(
                    name='user',
                    display_name='Utilisateur',
                    is_default=True
                )
    
    @staticmethod
    def validate_full_name(name):
        """Valide le format du nom complet"""
        name = re.sub(r'\s+', ' ', name.strip())
        
        patterns = [
            r'^[A-Za-z√Ä-√ø]+[\s_][A-Za-z√Ä-√ø]+[\s_]*[A-Za-z√Ä-√ø]*$',
            r'^[A-Z][a-z]+[A-Z][a-z]+[A-Z]*[a-z]*$',
        ]
        
        for pattern in patterns:
            if re.match(pattern, name):
                segments = re.split(r'[\s_]|(?=[A-Z])', name)
                segments = [s for s in segments if s]
                if len(segments) >= 2:
                    return True, name
        
        return False, None
    
    def save(self, *args, **kwargs):
        # S'assurer que l'email est en minuscules
        self.email = self.email.lower()
        
        # Attribuer un r√¥le par d√©faut si aucun n'est d√©fini
        if not self.role and not self.pk:
            self.role = self.get_default_role()
            
        super().save(*args, **kwargs)
    
    def delete_profile_picture(self):
        """Supprime la photo de profil actuelle"""
        if self.profile_picture:
            if os.path.isfile(self.profile_picture.path):
                os.remove(self.profile_picture.path)
            self.profile_picture = None
            self.save()


================================================================================
FILE: ./django_authentication/tests.py
================================================================================

from django.test import TestCase

# Create your tests here.



================================================================================
FILE: ./django_authentication/views.py
================================================================================

from django.shortcuts import render, redirect
from django.urls import reverse
from django.contrib import messages
from django.views.decorators.http import require_http_methods
from django.views.decorators.csrf import csrf_protect
from .forms import SignupForm, RoleManagementForm
from .models import User, Role
from django.contrib.auth.decorators import login_required
from django.core.cache import cache
from django.http import HttpResponseForbidden, HttpResponseRedirect
from .forms import LoginForm
import time
from django.http import JsonResponse
from django.views.decorators.http import require_POST
from django.core.files.base import ContentFile
import json
import base64
from .forms import ProfileUpdateForm
from django.db.models import Q, Count
from django.core.paginator import Paginator
from .forms import UserManagementForm
from functools import wraps
from django.urls import reverse
from .forms import UserManagementForm

def superuser_required(view_func):
    """D√©corateur pour v√©rifier que l'utilisateur est superuser"""
    @wraps(view_func)
    def _wrapped_view(request, *args, **kwargs):
        user = request.user_obj
        
        # V√©rification coh√©rente du r√¥le superuser
        if not user.role or user.role.name != 'superuser':
            messages.error(request, 'Acc√®s non autoris√©. Droits administrateur requis.')
            return redirect('user_dashboard')
            
        return view_func(request, *args, **kwargs)
    return _wrapped_view


def home_view(request):
    """Page d'accueil avec liens vers inscription/connexion"""
    return render(request, 'home.html')
    
@csrf_protect
@require_http_methods(["GET", "POST"])
def signup_view(request):
    """Vue d'inscription avec gestion compl√®te du formulaire"""
    
    if request.method == 'POST':
        form = SignupForm(request.POST)
        
        if form.is_valid():
            try:
                # Cr√©ation de l'utilisateur
                user = form.save(commit=False)
                user.phone = form.cleaned_data['phone_number']
                user.set_password(form.cleaned_data['password'])
                user.save()
                
                messages.success(
                    request,
                    'Inscription r√©ussie ! Vous pouvez maintenant vous connecter.'
                )
                return redirect('login')
                
            except Exception as e:
                messages.error(
                    request,
                    'Une erreur est survenue lors de l\'inscription. Veuillez r√©essayer.'
                )
                print(f"Erreur d'inscription: {str(e)}")
        else:
            messages.error(
                request,
                'Veuillez corriger les erreurs dans le formulaire.'
            )
    else:
        form = SignupForm()
    
    # Liste des pays avec indicatifs (s√©lection des plus courants)
    countries = [
        {'code': '+229', 'name': 'B√©nin', 'flag': 'üáßüáØ', 'iso': 'BJ'},
        {'code': '+33', 'name': 'France', 'flag': 'üá´üá∑', 'iso': 'FR'},
        {'code': '+1', 'name': '√âtats-Unis/Canada', 'flag': 'üá∫üá∏', 'iso': 'US'},
        {'code': '+44', 'name': 'Royaume-Uni', 'flag': 'üá¨üáß', 'iso': 'GB'},
        {'code': '+225', 'name': 'C√¥te d\'Ivoire', 'flag': 'üá®üáÆ', 'iso': 'CI'},
        {'code': '+221', 'name': 'S√©n√©gal', 'flag': 'üá∏üá≥', 'iso': 'SN'},
        {'code': '+228', 'name': 'Togo', 'flag': 'üáπüá¨', 'iso': 'TG'},
        {'code': '+226', 'name': 'Burkina Faso', 'flag': 'üáßüá´', 'iso': 'BF'},
        {'code': '+227', 'name': 'Niger', 'flag': 'üá≥üá™', 'iso': 'NE'},
        {'code': '+237', 'name': 'Cameroun', 'flag': 'üá®üá≤', 'iso': 'CM'},
        {'code': '+212', 'name': 'Maroc', 'flag': 'üá≤üá¶', 'iso': 'MA'},
        {'code': '+213', 'name': 'Alg√©rie', 'flag': 'üá©üáø', 'iso': 'DZ'},
        {'code': '+216', 'name': 'Tunisie', 'flag': 'üáπüá≥', 'iso': 'TN'},
        {'code': '+234', 'name': 'Nigeria', 'flag': 'üá≥üá¨', 'iso': 'NG'},
        {'code': '+233', 'name': 'Ghana', 'flag': 'üá¨üá≠', 'iso': 'GH'},
        {'code': '+32', 'name': 'Belgique', 'flag': 'üáßüá™', 'iso': 'BE'},
        {'code': '+41', 'name': 'Suisse', 'flag': 'üá®üá≠', 'iso': 'CH'},
        {'code': '+49', 'name': 'Allemagne', 'flag': 'üá©üá™', 'iso': 'DE'},
        {'code': '+39', 'name': 'Italie', 'flag': 'üáÆüáπ', 'iso': 'IT'},
        {'code': '+34', 'name': 'Espagne', 'flag': 'üá™üá∏', 'iso': 'ES'},
    ]
    
    context = {
        'form': form,
        'countries': countries,
    }
    
    return render(request, 'registration/signup.html', context)


# Configuration du throttling
MAX_LOGIN_ATTEMPTS = 5
LOCKOUT_DURATION = 300  # 5 minutes en secondes


def get_client_ip(request):
    """R√©cup√®re l'adresse IP du client"""
    x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
    if x_forwarded_for:
        ip = x_forwarded_for.split(',')[0]
    else:
        ip = request.META.get('REMOTE_ADDR')
    return ip


@csrf_protect
@require_http_methods(["GET", "POST"])
def login_view(request):
    """Vue de connexion avec protection contre force brute"""
    
    client_ip = get_client_ip(request)
    cache_key = f'login_attempts_{client_ip}'
    attempts = cache.get(cache_key, 0)
    
    if attempts >= MAX_LOGIN_ATTEMPTS:
        lockout_key = f'login_lockout_{client_ip}'
        lockout_time = cache.get(lockout_key)
        
        if lockout_time:
            remaining_time = int((lockout_time - time.time()) / 60)
            messages.error(
                request,
                f'Trop de tentatives de connexion. Veuillez r√©essayer dans {remaining_time} minutes.'
            )
            return render(request, 'registration/login.html', {'form': LoginForm(), 'locked_out': True})
    
    if request.method == 'POST':
        form = LoginForm(request.POST)
        
        if form.is_valid():
            user = form.get_user()
            
            if user is not None:
                # Connexion r√©ussie
                cache.delete(cache_key)
                cache.delete(f'login_lockout_{client_ip}')
                
                # Cr√©ation de la session
                request.session['user_id'] = user.id
                request.session['user_email'] = user.email
                # Stocker le nom du r√¥le au lieu de l'objet
                request.session['user_role'] = user.role.name if user.role else 'user'
                
                # Gestion "Se souvenir de moi"
                if form.cleaned_data.get('remember_me'):
                    request.session.set_expiry(1209600)  # 14 jours
                else:
                    request.session.set_expiry(0)
                
                messages.success(request, f'Bienvenue, {user.full_name} !')
                
                # DEBUG: Afficher les informations de l'utilisateur
                print("\n" + "="*50)
                print("=== DEBUG CONNEXION ===")
                print(f"Utilisateur: {user.email}")
                print(f"is_superuser: {getattr(user, 'is_superuser', 'Non d√©fini')}")
                print(f"is_staff: {getattr(user, 'is_staff', 'Non d√©fini')}")
                print(f"role: {getattr(user, 'role', 'Aucun r√¥le')}")
                if hasattr(user, 'role') and user.role:
                    print(f"role.name: {user.role.name}")
                
                # V√©rification des conditions de redirection
                is_super = getattr(user, 'is_superuser', False)
                has_role = hasattr(user, 'role') and user.role and user.role.name == 'superuser'
                
                print(f"\n=== VERIFICATION REDIRECTION ===")
                print(f"is_superuser: {is_super}")
                print(f"has superuser role: {has_role}")
                
                # REDIRECTION SELON LE R√îLE
                if is_super or has_role:
                    print("\n=== REDIRECTION ===")
                    print("Cible: superuser_dashboard")
                    print(f"URL: {reverse('superuser_dashboard')}")
                    return redirect('superuser_dashboard')
                else:
                    print("\n=== REDIRECTION ===")
                    print("Cible: user_dashboard (par d√©faut)")
                    print(f"URL: {reverse('user_dashboard')}")
                    return redirect('user_dashboard')
        else:
            # Tentative √©chou√©e
            attempts += 1
            cache.set(cache_key, attempts, LOCKOUT_DURATION)
            
            if attempts >= MAX_LOGIN_ATTEMPTS:
                lockout_time = time.time() + LOCKOUT_DURATION
                cache.set(f'login_lockout_{client_ip}', lockout_time, LOCKOUT_DURATION)
                messages.error(request, 'Trop de tentatives de connexion.')
            else:
                remaining_attempts = MAX_LOGIN_ATTEMPTS - attempts
                messages.error(request, f'Identifiants incorrects. {remaining_attempts} tentatives restantes.')
    else:
        form = LoginForm()
    
    return render(request, 'registration/login.html', {'form': form})

def login_required_custom(view_func):
    """D√©corateur personnalis√© pour v√©rifier l'authentification"""
    @wraps(view_func)
    def _wrapped_view(request, *args, **kwargs):
        # V√©rifie si l'utilisateur est authentifi√© via la session
        if 'user_id' not in request.session:
            messages.error(request, 'Veuillez vous connecter pour acc√©der √† cette page.')
            return redirect('login')
            
        # R√©cup√®re l'utilisateur depuis la base de donn√©es
        try:
            user = User.objects.select_related('role').get(id=request.session['user_id'])
            request.user_obj = user  # Stocke l'utilisateur dans la requ√™te
            
            # V√©rifie si l'utilisateur est actif
            if not user.is_active:
                messages.error(request, 'Votre compte est d√©sactiv√©. Veuillez contacter un administrateur.')
                return redirect('login')
                
            # V√©rifie si l'utilisateur a un r√¥le valide
            if not user.role:
                messages.error(request, 'Votre compte n\'a pas de r√¥le d√©fini. Veuillez contacter un administrateur.')
                return redirect('login')
                
            return view_func(request, *args, **kwargs)
            
        except User.DoesNotExist:
            messages.error(request, 'Session expir√©e. Veuillez vous reconnecter.')
            return redirect('login')
    
    return _wrapped_view

@login_required_custom
def superuser_dashboard_view(request):
    """Tableau de bord administrateur avec statistiques"""
    user = request.user_obj
    
    # V√©rification du r√¥le
    if not user.role or user.role.name != 'superuser':
        messages.error(request, 'Acc√®s non autoris√©. Droits administrateur requis.')
        return redirect('user_dashboard' if user.role and user.role.name == 'user' else 'login')
    
    # R√©cup√©ration des r√¥les
    from .models import Role
    
    try:
        superuser_role = Role.objects.get(name='superuser')
        user_role = Role.objects.get(name='user')
        
        # Statistiques
        total_users = User.objects.count()
        total_regular_users = User.objects.filter(role=user_role).count()
        total_superusers = User.objects.filter(role=superuser_role).count()
        active_users = User.objects.filter(is_active=True).count()
        inactive_users = User.objects.filter(is_active=False).count()
        
        # Utilisateurs r√©cents avec leurs r√¥les
        recent_users = User.objects.select_related('role').order_by('-created_at')[:5]
        
        context = {
            'user': user,
            'page_title': 'Tableau de bord administrateur',
            'stats': {
                'total_users': total_users,
                'regular_users': total_regular_users,
                'superusers': total_superusers,
                'active_users': active_users,
                'inactive_users': inactive_users,
            },
            'recent_users': recent_users,
        }
    except Role.DoesNotExist:
        messages.error(request, 'Erreur de configuration: les r√¥les par d√©faut n\'existent pas.')
        return redirect('user_dashboard')
    
    return render(request, 'dashboards/superuser_dashboard.html', context)

@login_required_custom
@superuser_required
def user_management_list(request):
    """Liste des utilisateurs avec recherche et pagination - VERSION UNIFI√âE"""
    user = request.user_obj
    
    search_query = request.GET.get('search', '').strip()
    role_filter = request.GET.get('role', '')
    status_filter = request.GET.get('status', '')
    
    users = User.objects.select_related('role').all().order_by('-created_at')
    
    if search_query:
        users = users.filter(
            Q(full_name__icontains=search_query) |
            Q(email__icontains=search_query) |
            Q(phone__icontains=search_query)
        )
    
    if role_filter:
        users = users.filter(role__name=role_filter)
    
    if status_filter == 'active':
        users = users.filter(is_active=True)
    elif status_filter == 'inactive':
        users = users.filter(is_active=False)
    
    # Pagination
    paginator = Paginator(users, 20)
    page_number = request.GET.get('page', 1)
    page_obj = paginator.get_page(page_number)
    
    # R√¥les disponibles pour le filtre
    from .models import Role
    available_roles = Role.objects.all()
    
    context = {
        'user': user,
        'page_obj': page_obj,
        'search_query': search_query,
        'role_filter': role_filter,
        'status_filter': status_filter,
        'available_roles': available_roles,
        'page_title': 'Gestion des utilisateurs'
    }
    
    return render(request, 'admin/user_management.html', context)

@login_required_custom
@superuser_required
def user_create_view(request):
    """Cr√©ation d'un nouvel utilisateur"""
    admin_user = request.user_obj
    
    if request.method == 'POST':
        form = UserManagementForm(request.POST, request.FILES, is_edit=False)
        
        if form.is_valid():
            try:
                user = form.save()
                messages.success(request, f'Utilisateur {user.full_name} cr√©√© avec succ√®s.')
                return redirect('user_management')
            except Exception as e:
                messages.error(request, f'Erreur lors de la cr√©ation: {str(e)}')
        else:
            messages.error(request, 'Veuillez corriger les erreurs dans le formulaire.')
    else:
        form = UserManagementForm(is_edit=False)
    
    context = {
        'user': admin_user,
        'form': form,
        'is_edit': False,
        'page_title': 'Cr√©er un utilisateur',
    }
    
    return render(request, 'admin/user_form.html', context)


@login_required_custom
@superuser_required
def user_edit_view(request, user_id):
    """√âdition d'un utilisateur existant"""
    admin_user = request.user_obj
    
    try:
        user_to_edit = User.objects.get(id=user_id)
    except User.DoesNotExist:
        messages.error(request, 'Utilisateur introuvable.')
        return redirect('user_management')
    
    if request.method == 'POST':
        form = UserManagementForm(
            request.POST,
            request.FILES,
            instance=user_to_edit,
            is_edit=True
        )
        
        if form.is_valid():
            try:
                user = form.save()
                messages.success(request, f'Utilisateur {user.full_name} modifi√© avec succ√®s.')
                return redirect('user_management')
            except Exception as e:
                messages.error(request, f'Erreur lors de la modification: {str(e)}')
        else:
            messages.error(request, 'Veuillez corriger les erreurs dans le formulaire.')
    else:
        form = UserManagementForm(instance=user_to_edit, is_edit=True)
    
    context = {
        'user': admin_user,
        'form': form,
        'user_to_edit': user_to_edit,
        'is_edit': True,
        'page_title': f'Modifier {user_to_edit.full_name}',
    }
    
    return render(request, 'admin/user_form.html', context)


@csrf_protect
@require_POST
@login_required_custom
@superuser_required
def user_delete_view(request, user_id):
    """Suppression d'un utilisateur"""
    admin_user = request.user_obj
    
    try:
        user_to_delete = User.objects.get(id=user_id)
        
        # Emp√™cher la suppression de soi-m√™me
        if user_to_delete.id == admin_user.id:
            return JsonResponse({
                'success': False,
                'message': 'Vous ne pouvez pas supprimer votre propre compte.'
            }, status=400)
        
        # Emp√™cher la suppression du dernier superuser
        if user_to_delete.role and user_to_delete.role.name == 'superuser':
            superuser_count = User.objects.filter(role__name='superuser').count()
            if superuser_count <= 1:
                return JsonResponse({
                    'success': False,
                    'message': 'Impossible de supprimer le dernier superutilisateur.'
                }, status=400)
        
        full_name = user_to_delete.full_name
        user_to_delete.delete()
        
        return JsonResponse({
            'success': True,
            'message': f'Utilisateur {full_name} supprim√© avec succ√®s.'
        })
        
    except User.DoesNotExist:
        return JsonResponse({
            'success': False,
            'message': 'Utilisateur introuvable.'
        }, status=404)
    except Exception as e:
        return JsonResponse({
            'success': False,
            'message': f'Erreur: {str(e)}'
        }, status=500)


@csrf_protect
@require_POST
@login_required_custom
@superuser_required
def user_toggle_status_view(request, user_id):
    """Active/d√©sactive un utilisateur"""
    admin_user = request.user_obj
    
    try:
        user_to_toggle = User.objects.get(id=user_id)
        
        # Emp√™cher la d√©sactivation de soi-m√™me
        if user_to_toggle.id == admin_user.id:
            return JsonResponse({
                'success': False,
                'message': 'Vous ne pouvez pas modifier votre propre statut.'
            }, status=400)
        
        user_to_toggle.is_active = not user_to_toggle.is_active
        user_to_toggle.save()
        
        status_text = 'activ√©' if user_to_toggle.is_active else 'd√©sactiv√©'
        
        return JsonResponse({
            'success': True,
            'message': f'Utilisateur {user_to_toggle.full_name} {status_text}.',
            'is_active': user_to_toggle.is_active
        })
        
    except User.DoesNotExist:
        return JsonResponse({
            'success': False,
            'message': 'Utilisateur introuvable.'
        }, status=404)
    except Exception as e:
        return JsonResponse({
            'success': False,
            'message': f'Erreur: {str(e)}'
        }, status=500)

@csrf_protect
@require_http_methods(["POST"])
def logout_view(request):
    """Vue de d√©connexion"""
    # Stocker le message de d√©connexion
    messages.success(request, 'Vous avez √©t√© d√©connect√© avec succ√®s.')
    
    # Nettoyer les donn√©es de session
    if 'user_id' in request.session:
        del request.session['user_id']
    if 'user_email' in request.session:
        del request.session['user_email']
    if 'user_role' in request.session:
        del request.session['user_role']
    
    # Vider compl√®tement la session
    request.session.flush()
    
    # Rediriger vers la page de connexion ou la page demand√©e
    next_page = request.POST.get('next', 'login')
    return redirect(next_page)


def reset_password_view(request):
    """Page de r√©initialisation de mot de passe (placeholder)"""
    return render(request, 'registration/reset_password.html')


@login_required_custom
def user_interface_view(request):
    """Interface utilisateur standard"""
    user = request.user_obj
    
    # V√©rification du r√¥le
    if not user.role:
        messages.error(request, 'Votre compte n\'a pas de r√¥le d√©fini. Veuillez contacter un administrateur.')
        return redirect('login')
        
    # Si l'utilisateur est un superutilisateur, on le redirige vers l'interface administrateur
    if user.role.name == 'superuser':
        return redirect('superuser_interface')
    
    return render(request, 'interfaces/user_interface.html', {'user': user})


@login_required_custom
def superuser_interface_view(request):
    """Interface super utilisateur"""
    user = request.user_obj
    
    # V√©rification du r√¥le
    if not user.role or user.role.name != 'superuser':
        messages.error(request, 'Acc√®s non autoris√©. Droits administrateur requis.')
        return redirect('user_interface' if user.role and user.role.name == 'user' else 'login')
    
    return render(request, 'interfaces/superuser_interface.html', {'user': user})

# D√©corateur personnalis√© pour v√©rifier l'authentification
def login_required_custom(view_func):
    """D√©corateur personnalis√© pour v√©rifier l'authentification"""
    def wrapper(request, *args, **kwargs):
        user_id = request.session.get('user_id')
        if not user_id:
            messages.error(request, 'Vous devez √™tre connect√© pour acc√©der √† cette page.')
            return redirect('login')
        
        try:
            user = User.objects.get(id=user_id)
            request.user_obj = user
            return view_func(request, *args, **kwargs)
        except User.DoesNotExist:
            request.session.flush()
            messages.error(request, 'Session invalide. Veuillez vous reconnecter.')
            return redirect('login')
    
    return wrapper

@login_required_custom
def user_dashboard_view(request):
    """Tableau de bord utilisateur standard"""
    user = request.user_obj
    
    # V√©rification du r√¥le
    if not user.role:
        messages.error(request, 'Votre compte n\'a pas de r√¥le d√©fini. Veuillez contacter un administrateur.')
        return redirect('login')
        
    # Si l'utilisateur est un superutilisateur, on le redirige vers le tableau de bord administrateur
    if user.role.name == 'superuser':
        return redirect('superuser_dashboard')
    
    # Chargement des donn√©es sp√©cifiques √† l'utilisateur
    context = {
        'user': user,
        'page_title': 'Tableau de bord utilisateur'
    }
    
    return render(request, 'dashboards/user_dashboard.html', context)

@login_required_custom
def superuser_dashboard_view(request):
    """Tableau de bord administrateur avec statistiques en temps r√©el"""
    user = request.user_obj
    
    # V√©rification du r√¥le
    if not user.role or user.role.name != 'superuser':
        messages.error(request, 'Acc√®s non autoris√©. Droits administrateur requis.')
        return redirect('user_dashboard' if user.role and user.role.name == 'user' else 'login')
    
    # R√©cup√©ration des r√¥les
    from .models import Role
    
    try:
        superuser_role = Role.objects.get(name='superuser')
        user_role = Role.objects.get(name='user')
        
        # Statistiques en temps r√©el
        stats = {
            'total_users': User.objects.count(),
            'regular_users': User.objects.filter(role=user_role).count(),
            'superusers': User.objects.filter(role=superuser_role).count(),
            'active_users': User.objects.filter(is_active=True).count(),
            'inactive_users': User.objects.filter(is_active=False).count(),
        }
        
        context = {
            'user': user,
            'page_title': 'Tableau de bord administrateur',
            'stats': stats,
        }
    except Role.DoesNotExist:
        messages.error(request, 'Erreur de configuration: les r√¥les par d√©faut n\'existent pas.')
        return redirect('user_dashboard')
    
    return render(request, 'dashboards/superuser_dashboard.html', context)

@csrf_protect
@require_POST
@login_required_custom
def update_profile_ajax(request):
    """API pour mettre √† jour le profil utilisateur (AJAX)"""
    user = request.user_obj
    
    try:
        # V√©rifie si on doit supprimer la photo de profil
        delete_picture = request.POST.get('delete_picture') == 'true'
        
        # R√©cup√®re les donn√©es du formulaire
        form = ProfileUpdateForm(request.POST, request.FILES, instance=user)
        
        if form.is_valid():
            updated_user = form.save(commit=False)
            
            # Supprime la photo de profil si demand√©
            if delete_picture and updated_user.profile_picture:
                # Supprime le fichier du stockage
                updated_user.profile_picture.delete(save=False)
                # Efface la r√©f√©rence au fichier
                updated_user.profile_picture = None
            
            # Sauvegarde les modifications
            updated_user.save()
            
            # Met √† jour la session
            request.session['user_email'] = updated_user.email
            
            # Recharge l'utilisateur pour s'assurer d'avoir les derni√®res donn√©es
            updated_user.refresh_from_db()
            
            return JsonResponse({
                'success': True,
                'message': 'Profil mis √† jour avec succ√®s',
                'data': {
                    'full_name': updated_user.full_name,
                    'email': updated_user.email,
                    'phone': updated_user.phone or '',
                    'initials': updated_user.get_initials(),
                    'profile_picture_url': updated_user.get_profile_picture_url() or ''
                }
            })
        else:
            # Retourne les erreurs de validation
            errors = {}
            for field, error_list in form.errors.items():
                errors[field] = error_list[0]
            
            return JsonResponse({
                'success': False,
                'message': 'Erreur de validation',
                'errors': errors
            }, status=400)
    
    except Exception as e:
        return JsonResponse({
            'success': False,
            'message': f'Erreur lors de la mise √† jour: {str(e)}'
        }, status=500)

@csrf_protect
@require_POST
@login_required_custom
def delete_profile_picture_ajax(request):
    """API pour supprimer la photo de profil (AJAX)"""
    user = request.user_obj
    
    try:
        user.delete_profile_picture()
        
        return JsonResponse({
            'success': True,
            'message': 'Photo de profil supprim√©e avec succ√®s',
            'data': {
                'initials': user.get_initials()
            }
        })
    
    except Exception as e:
        return JsonResponse({
            'success': False,
            'message': f'Erreur lors de la suppression: {str(e)}'
        }, status=500)


# ============================================================================
# GESTION DES R√îLES
# ============================================================================

@login_required_custom
@superuser_required
def manage_roles_view(request):
    """Page de gestion des r√¥les"""
    user = request.user_obj
    
    # R√©cup√©rer tous les r√¥les avec le compte d'utilisateurs
    all_roles = Role.objects.annotate(
        user_count=Count('users')
    ).order_by('name')
    
    # S√©parer les r√¥les syst√®me et personnalis√©s
    system_roles = all_roles.filter(name__in=['user', 'superuser'])
    custom_roles = all_roles.exclude(name__in=['user', 'superuser'])
    
    context = {
        'user': user,
        'system_roles': system_roles,
        'custom_roles': custom_roles,
        'page_title': 'Gestion des r√¥les',
    }
    
    return render(request, 'admin/manage_roles.html', context)


@login_required_custom
@superuser_required
def role_create_view(request):
    """Cr√©ation d'un nouveau r√¥le personnalis√©"""
    user = request.user_obj
    
    if request.method == 'POST':
        form = RoleManagementForm(request.POST, is_system_role=False)
        
        if form.is_valid():
            try:
                role = form.save(commit=False)
                
                # Si ce r√¥le est d√©fini comme d√©faut, d√©sactiver les autres
                if role.is_default:
                    Role.objects.filter(is_default=True).update(is_default=False)
                
                role.save()
                
                messages.success(request, f'R√¥le "{role.display_name}" cr√©√© avec succ√®s.')
                return redirect('manage_roles')
            except Exception as e:
                messages.error(request, f'Erreur lors de la cr√©ation: {str(e)}')
        else:
            messages.error(request, 'Veuillez corriger les erreurs dans le formulaire.')
    else:
        form = RoleManagementForm(is_system_role=False)
    
    context = {
        'user': user,
        'form': form,
        'is_edit': False,
        'is_system_role': False,
        'page_title': 'Cr√©er un r√¥le',
    }
    
    return render(request, 'admin/role_form.html', context)


@login_required_custom
@superuser_required
def role_edit_view(request, role_id):
    """Modification d'un r√¥le existant"""
    user = request.user_obj
    
    try:
        role = Role.objects.get(id=role_id)
    except Role.DoesNotExist:
        messages.error(request, 'R√¥le introuvable.')
        return redirect('manage_roles')
    
    # V√©rifier si c'est un r√¥le syst√®me
    is_system = role.name in ['user', 'superuser']
    
    if request.method == 'POST':
        form = RoleManagementForm(
            request.POST,
            instance=role,
            is_system_role=is_system
        )
        
        if form.is_valid():
            try:
                updated_role = form.save(commit=False)
                
                # Si ce r√¥le est d√©fini comme d√©faut, d√©sactiver les autres
                if updated_role.is_default:
                    Role.objects.filter(is_default=True).exclude(pk=updated_role.pk).update(is_default=False)
                
                updated_role.save()
                
                messages.success(request, f'R√¥le "{updated_role.display_name}" modifi√© avec succ√®s.')
                return redirect('manage_roles')
            except Exception as e:
                messages.error(request, f'Erreur lors de la modification: {str(e)}')
        else:
            messages.error(request, 'Veuillez corriger les erreurs dans le formulaire.')
    else:
        form = RoleManagementForm(instance=role, is_system_role=is_system)
    
    context = {
        'user': user,
        'form': form,
        'role': role,
        'is_edit': True,
        'is_system_role': is_system,
        'page_title': f'Modifier {role.display_name}',
    }
    
    return render(request, 'admin/role_form.html', context)


@csrf_protect
@require_POST
@login_required_custom
@superuser_required
def role_delete_view(request, role_id):
    """Suppression d'un r√¥le personnalis√©"""
    user = request.user_obj
    
    try:
        role = Role.objects.get(id=role_id)
        
        # Emp√™cher la suppression des r√¥les syst√®me
        if role.name in ['user', 'superuser']:
            return JsonResponse({
                'success': False,
                'message': 'Les r√¥les syst√®me ne peuvent pas √™tre supprim√©s.'
            }, status=400)
        
        # V√©rifier si des utilisateurs ont ce r√¥le
        user_count = role.users.count()
        if user_count > 0:
            return JsonResponse({
                'success': False,
                'message': f'Impossible de supprimer ce r√¥le. {user_count} utilisateur(s) l\'utilisent encore.'
            }, status=400)
        
        role_name = role.display_name
        role.delete()
        
        return JsonResponse({
            'success': True,
            'message': f'R√¥le "{role_name}" supprim√© avec succ√®s.'
        })
        
    except Role.DoesNotExist:
        return JsonResponse({
            'success': False,
            'message': 'R√¥le introuvable.'
        }, status=404)
    except Exception as e:
        return JsonResponse({
            'success': False,
            'message': f'Erreur: {str(e)}'
        }, status=500)

================================================================================
FILE: ./django_authentication/apps.py
================================================================================

from django.apps import AppConfig


class DjangoAuthenticationConfig(AppConfig):
    default_auto_field = "django.db.models.BigAutoField"
    name = "django_authentication"



================================================================================
FILE: ./django_authentication/admin.py
================================================================================

from django.contrib import admin
from django.contrib.auth.admin import UserAdmin as BaseUserAdmin
from django.utils.translation import gettext_lazy as _
from django import forms
from django.contrib import messages
from django.http import HttpResponseRedirect
from django.urls import reverse
from django.utils.html import format_html
from django.utils.safestring import mark_safe
from django.contrib.auth.forms import (
    UserChangeForm as BaseUserChangeForm,
    UserCreationForm as BaseUserCreationForm
)

from .models import User, Role

class RoleAdminForm(forms.ModelForm):
    class Meta:
        model = Role
        fields = '__all__'

    def clean(self):
        cleaned_data = super().clean()
        is_default = cleaned_data.get('is_default')
        
        # Si on essaie de d√©finir ce r√¥le comme r√¥le par d√©faut
        if is_default:
            # V√©rifier si un autre r√¥le est d√©j√† d√©fini comme r√¥le par d√©faut
            existing_default = Role.objects.filter(is_default=True).exclude(pk=self.instance.pk if self.instance else None)
            if existing_default.exists():
                # Si un autre r√¥le est d√©j√† d√©fini comme r√¥le par d√©faut, le d√©selectionner
                existing_default.update(is_default=False)
        
        return cleaned_data


@admin.register(Role)
class RoleAdmin(admin.ModelAdmin):
    """Administration du mod√®le Role"""
    form = RoleAdminForm
    list_display = ('name', 'display_name', 'is_default', 'user_count', 'created_at')
    list_filter = ('is_default', 'created_at')
    search_fields = ('name', 'display_name')
    readonly_fields = ('created_at', 'updated_at', 'user_count_display')
    fieldsets = (
        (None, {
            'fields': ('name', 'display_name', 'is_default', 'permissions')
        }),
        ('M√©tadonn√©es', {
            'fields': ('created_at', 'updated_at', 'user_count_display'),
            'classes': ('collapse',)
        }),
    )
    
    def user_count_display(self, obj):
        return obj.users.count()
    user_count_display.short_description = _("Nombre d'utilisateurs")
    
    def user_count(self, obj):
        return obj.users.count()
    user_count.short_description = _('Utilisateurs')
    
    def get_readonly_fields(self, request, obj=None):
        # Ne pas permettre la modification du nom du r√¥le syst√®me
        if obj and obj.name in ['user', 'superuser']:
            return self.readonly_fields + ('name', 'is_default')
        return self.readonly_fields
    
    def has_delete_permission(self, request, obj=None):
        # Emp√™cher la suppression des r√¥les syst√®me
        if obj and obj.name in ['user', 'superuser']:
            return False
        return super().has_delete_permission(request, obj)


class UserCreationForm(BaseUserCreationForm):
    class Meta:
        model = User
        fields = ('email', 'full_name', 'phone')
    
    def clean_email(self):
        email = self.cleaned_data.get('email')
        if email:
            email = email.lower()
        return email


class UserChangeForm(BaseUserChangeForm):
    class Meta:
        model = User
        fields = '__all__'
    
    def clean_email(self):
        email = self.cleaned_data.get('email')
        if email:
            email = email.lower()
        return email


@admin.register(User)
class UserAdmin(BaseUserAdmin):
    """Administration du mod√®le User"""
    
    form = UserChangeForm
    add_form = UserCreationForm
    
    list_display = ('email', 'full_name', 'phone', 'role_display', 'is_active', 'date_joined')
    list_filter = ('role', 'is_active', 'date_joined')
    search_fields = ('email', 'full_name', 'phone')
    ordering = ('-date_joined',)
    readonly_fields = ('date_joined', 'last_login', 'created_at', 'updated_at')
    filter_horizontal = ('user_permissions', 'groups')
    
    fieldsets = (
        (None, {
            'fields': ('email', 'password')
        }),
        (_('Informations personnelles'), {
            'fields': ('full_name', 'phone', 'profile_picture')
        }),
        (_('R√¥le et permissions'), {
            'fields': ('role', 'is_active', 'is_staff', 'groups', 'user_permissions')
        }),
        (_('Dates importantes'), {
            'fields': ('date_joined', 'last_login', 'created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    add_fieldsets = (
        (None, {
            'classes': ('wide',),
            'fields': ('email', 'full_name', 'phone', 'password1', 'password2', 'role'),
        }),
    )
    
    def role_display(self, obj):
        return obj.get_role_display()
    role_display.short_description = _('R√¥le')
    role_display.admin_order_field = 'role__name'
    
    def get_readonly_fields(self, request, obj=None):
        # Ne pas permettre la modification du r√¥le superuser
        if obj and obj.is_superuser() and not request.user.is_superuser():
            return self.readonly_fields + ('role', 'is_staff', 'is_active')
        return self.readonly_fields
    
    def has_delete_permission(self, request, obj=None):
        # Emp√™cher la suppression de l'utilisateur superuser
        if obj and obj.is_superuser() and not request.user.is_superuser():
            return False
        return super().has_delete_permission(request, obj)
    
    def save_model(self, request, obj, form, change):
        # Si c'est un nouvel utilisateur et qu'aucun r√¥le n'est d√©fini, utiliser le r√¥le par d√©faut
        if not change and not obj.role:
            obj.role = User.get_default_role()
        
        # Si le mot de passe a √©t√© modifi√©, le hasher
        if 'password' in form.changed_data:
            obj.set_password(form.cleaned_data['password'])
        
        super().save_model(request, obj, form, change)
    
    def response_add(self, request, obj, post_url_continue=None):
        """Rediriger vers la page d'√©dition apr√®s l'ajout d'un utilisateur"""
        if '_addanother' in request.POST:
            return super().response_add(request, obj, post_url_continue)
        return HttpResponseRedirect(reverse('admin:django_authentication_user_changelist'))
    
    def get_actions(self, request):
        """D√©sactiver la suppression en masse pour les utilisateurs non superusers"""
        actions = super().get_actions(request)
        if not request.user.is_superuser:
            if 'delete_selected' in actions:
                del actions['delete_selected']
        return actions


================================================================================
FILE: ./django_authentication/forms.py
================================================================================

from django import forms
from .models import User, Role
import re
import phonenumbers
from phonenumbers import NumberParseException
from django.contrib.auth import authenticate
from django.core.exceptions import ValidationError
from django.core.files.uploadedfile import InMemoryUploadedFile
from PIL import Image
import io

class SignupForm(forms.ModelForm):
    """Formulaire d'inscription avec validations avanc√©es"""
    
    password = forms.CharField(
        widget=forms.PasswordInput(attrs={
            'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all',
            'placeholder': 'Mot de passe',
            'id': 'password'
        }),
        label="Mot de passe"
    )
    
    password_confirm = forms.CharField(
        widget=forms.PasswordInput(attrs={
            'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all',
            'placeholder': 'Confirmer le mot de passe',
            'id': 'password_confirm'
        }),
        label="Confirmation du mot de passe"
    )
    
    country_code = forms.CharField(
        widget=forms.HiddenInput(attrs={'id': 'country_code'}),
        required=False,
        initial='+229'  # B√©nin par d√©faut
    )
    
    phone_number = forms.CharField(
        widget=forms.TextInput(attrs={
            'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all',
            'placeholder': '90 00 00 00',
            'id': 'phone_number'
        }),
        label="Num√©ro de t√©l√©phone"
    )
    
    accept_terms = forms.BooleanField(
        required=True,
        widget=forms.CheckboxInput(attrs={
            'class': 'w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500',
            'id': 'accept_terms'
        }),
        error_messages={'required': 'Vous devez accepter les conditions d\'utilisation'}
    )
    
    class Meta:
        model = User
        fields = ['full_name', 'email']
        widgets = {
            'full_name': forms.TextInput(attrs={
                'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all',
                'placeholder': 'Nom Pr√©nom(s)',
                'id': 'full_name'
            }),
            'email': forms.EmailInput(attrs={
                'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all',
                'placeholder': 'exemple@email.com',
                'id': 'email'
            }),
        }
        labels = {
            'full_name': 'Nom complet',
            'email': 'Adresse e-mail'
        }
    
    def clean_full_name(self):
        """Valide le format du nom complet"""
        full_name = self.cleaned_data.get('full_name', '').strip()
        
        # Protection XSS
        full_name = re.sub(r'[<>\"\'&]', '', full_name)
        
        is_valid, normalized_name = User.validate_full_name(full_name)
        
        if not is_valid:
            raise forms.ValidationError(
                'Format invalide. Utilisez: "Nom Pr√©nom", "Nom_Pr√©nom" ou "NomPr√©nom" (minimum 2 segments)'
            )
        
        return normalized_name
    
    def clean_email(self):
        """Valide et normalise l'email"""
        email = self.cleaned_data.get('email', '').lower().strip()
        
        # Validation RFC 5322 basique
        email_regex = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
        if not re.match(email_regex, email):
            raise forms.ValidationError('Format d\'adresse e-mail invalide')
        
        # V√©rification d'unicit√©
        if User.objects.filter(email=email).exists():
            raise forms.ValidationError('Cette adresse e-mail est d√©j√† utilis√©e')
        
        # Protection contre emails jetables (liste basique)
        disposable_domains = [
            'tempmail.com', 'throwaway.email', '10minutemail.com',
            'guerrillamail.com', 'mailinator.com', 'trashmail.com'
        ]
        domain = email.split('@')[1]
        if domain in disposable_domains:
            raise forms.ValidationError('Les adresses e-mail jetables ne sont pas autoris√©es')
        
        return email
    
    def clean_phone_number(self):
        """Valide le num√©ro de t√©l√©phone"""
        phone_number = self.cleaned_data.get('phone_number', '').strip()
        country_code = self.data.get('country_code', '+229')
        
        # Construit le num√©ro complet
        full_number = country_code + re.sub(r'[\s\-\(\)]', '', phone_number)
        
        try:
            parsed_number = phonenumbers.parse(full_number, None)
            if not phonenumbers.is_valid_number(parsed_number):
                raise forms.ValidationError('Num√©ro de t√©l√©phone invalide pour ce pays')
            
            # Format international
            formatted_number = phonenumbers.format_number(
                parsed_number,
                phonenumbers.PhoneNumberFormat.E164
            )
            
            # V√©rification d'unicit√©
            if User.objects.filter(phone=formatted_number).exists():
                raise forms.ValidationError('Ce num√©ro de t√©l√©phone est d√©j√† utilis√©')
            
            return formatted_number
            
        except NumberParseException:
            raise forms.ValidationError('Format de num√©ro de t√©l√©phone invalide')
    
    def clean_password(self):
        """Valide la robustesse du mot de passe"""
        password = self.cleaned_data.get('password', '')
        
        if len(password) < 8:
            raise forms.ValidationError('Le mot de passe doit contenir au moins 8 caract√®res')
        
        if not re.search(r'[A-Z]', password):
            raise forms.ValidationError('Le mot de passe doit contenir au moins une majuscule')
        
        if not re.search(r'[a-z]', password):
            raise forms.ValidationError('Le mot de passe doit contenir au moins une minuscule')
        
        if not re.search(r'\d', password):
            raise forms.ValidationError('Le mot de passe doit contenir au moins un chiffre')
        
        if not re.search(r'[!@#$%^&*(),.?":{}|<>]', password):
            raise forms.ValidationError('Le mot de passe doit contenir au moins un caract√®re sp√©cial')
        
        # V√©rification contre donn√©es personnelles (si disponibles)
        if hasattr(self, 'cleaned_data'):
            full_name = self.cleaned_data.get('full_name', '')
            email = self.cleaned_data.get('email', '')
            
            name_parts = re.split(r'[\s_]|(?=[A-Z])', full_name.lower())
            for part in name_parts:
                if part and len(part) > 2 and part in password.lower():
                    raise forms.ValidationError('Le mot de passe ne doit pas contenir votre nom')
            
            email_local = email.split('@')[0].lower()
            if email_local in password.lower():
                raise forms.ValidationError('Le mot de passe ne doit pas contenir votre adresse e-mail')
        
        return password
    
    def clean(self):
        """Validation finale et coh√©rence des mots de passe"""
        cleaned_data = super().clean()
        password = cleaned_data.get('password')
        password_confirm = cleaned_data.get('password_confirm')
        
        if password and password_confirm and password != password_confirm:
            raise forms.ValidationError('Les mots de passe ne correspondent pas')
        
        # Combine country_code et phone_number pour le champ phone du mod√®le
        phone_number = cleaned_data.get('phone_number')
        if phone_number:
            cleaned_data['phone'] = phone_number
        
        return cleaned_data

class LoginForm(forms.Form):
    """Formulaire de connexion s√©curis√© avec validations"""
    
    email = forms.EmailField(
        widget=forms.EmailInput(attrs={
            'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all',
            'placeholder': 'exemple@email.com',
            'id': 'email',
            'autocomplete': 'email'
        }),
        label="Adresse e-mail",
        error_messages={
            'required': 'L\'adresse e-mail est obligatoire',
            'invalid': 'Veuillez entrer une adresse e-mail valide'
        }
    )
    
    password = forms.CharField(
        widget=forms.PasswordInput(attrs={
            'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all',
            'placeholder': 'Mot de passe',
            'id': 'password',
            'autocomplete': 'current-password'
        }),
        label="Mot de passe",
        error_messages={
            'required': 'Le mot de passe est obligatoire'
        }
    )
    
    remember_me = forms.BooleanField(
        required=False,
        widget=forms.CheckboxInput(attrs={
            'class': 'w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500',
            'id': 'remember_me'
        }),
        label="Se souvenir de moi"
    )
    
    def __init__(self, *args, **kwargs):
        self.user_cache = None
        super().__init__(*args, **kwargs)
    
    def clean_email(self):
        """Normalise l'email"""
        email = self.cleaned_data.get('email', '').lower().strip()
        
        # Protection XSS basique
        email = re.sub(r'[<>\"\'&]', '', email)
        
        return email
    
    def clean(self):
        """Valide les identifiants"""
        cleaned_data = super().clean()
        email = cleaned_data.get('email')
        password = cleaned_data.get('password')
        
        if email and password:
            # Recherche de l'utilisateur par email avec select_related pour charger le r√¥le
            try:
                from .models import User
                user = User.objects.select_related('role').get(email=email)
                
                # V√©rification du mot de passe
                if not user.check_password(password):
                    raise ValidationError(
                        'Identifiants incorrects. Veuillez v√©rifier votre email et mot de passe.',
                        code='invalid_login'
                    )
                
                # V√©rification que l'utilisateur est actif
                if not user.is_active:
                    raise ValidationError(
                        'Ce compte est d√©sactiv√©. Veuillez contacter un administrateur.',
                        code='inactive_account'
                    )
                
                # Stockage de l'utilisateur pour utilisation dans la vue
                self.user_cache = user
                
            except User.DoesNotExist:
                raise ValidationError(
                    'Identifiants incorrects. Veuillez v√©rifier votre email et mot de passe.',
                    code='invalid_login'
                )
        
        return cleaned_data
    
    def get_user(self):
        """Retourne l'utilisateur authentifi√©"""
        return self.user_cache

class ProfileUpdateForm(forms.ModelForm):
    """Formulaire de mise √† jour du profil utilisateur"""
    
    class Meta:
        model = User
        fields = ['full_name', 'email', 'phone', 'profile_picture']
    
    def __init__(self, *args, **kwargs):
        self.user_instance = kwargs.get('instance')
        super().__init__(*args, **kwargs)
        
        # Rend l'email unique sauf pour l'utilisateur actuel
        if self.user_instance:
            self.fields['email'].required = True
            self.fields['phone'].required = True
    
    def clean_profile_picture(self):
        """Valide et optimise la photo de profil"""
        picture = self.cleaned_data.get('profile_picture')
        
        if picture and hasattr(picture, 'size'):
            # Limite de taille : 5MB
            if picture.size > 5 * 1024 * 1024:
                raise forms.ValidationError('La taille de l\'image ne doit pas d√©passer 5MB')
            
            # V√©rifie que c'est bien une image
            try:
                img = Image.open(picture)
                img.verify()
                
                # R√©ouvre l'image pour la manipulation
                picture.seek(0)
                img = Image.open(picture)
                
                # Optimise l'image (redimensionne si trop grande)
                max_size = (800, 800)
                if img.size[0] > max_size[0] or img.size[1] > max_size[1]:
                    img.thumbnail(max_size, Image.Resampling.LANCZOS)
                    
                    # Sauvegarde l'image optimis√©e
                    output = io.BytesIO()
                    img_format = img.format if img.format else 'JPEG'
                    img.save(output, format=img_format, quality=85, optimize=True)
                    output.seek(0)
                    
                    picture = InMemoryUploadedFile(
                        output,
                        'ImageField',
                        picture.name,
                        f'image/{img_format.lower()}',
                        output.getbuffer().nbytes,
                        None
                    )
            
            except Exception as e:
                raise forms.ValidationError('Fichier image invalide')
        
        return picture
    
    def clean_full_name(self):
        """Valide le format du nom complet"""
        full_name = self.cleaned_data.get('full_name', '').strip()
        full_name = re.sub(r'[<>\"\'&]', '', full_name)
        
        is_valid, normalized_name = User.validate_full_name(full_name)
        
        if not is_valid:
            raise forms.ValidationError(
                'Format invalide. Utilisez: "Nom Pr√©nom", "Nom_Pr√©nom" ou "NomPr√©nom"'
            )
        
        return normalized_name
    
    def clean_email(self):
        """Valide et normalise l'email"""
        email = self.cleaned_data.get('email', '').lower().strip()
        
        email_regex = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
        if not re.match(email_regex, email):
            raise forms.ValidationError('Format d\'adresse e-mail invalide')
        
        # V√©rification d'unicit√© (exclut l'utilisateur actuel)
        if self.user_instance:
            if User.objects.filter(email=email).exclude(id=self.user_instance.id).exists():
                raise forms.ValidationError('Cette adresse e-mail est d√©j√† utilis√©e')
        
        return email
    
    def clean_phone(self):
        """Valide le num√©ro de t√©l√©phone"""
        phone = self.cleaned_data.get('phone', '').strip()
        
        # V√©rification d'unicit√© (exclut l'utilisateur actuel)
        if self.user_instance:
            if User.objects.filter(phone=phone).exclude(id=self.user_instance.id).exists():
                raise forms.ValidationError('Ce num√©ro de t√©l√©phone est d√©j√† utilis√©')
        
        return phone

class UserManagementForm(forms.ModelForm):
    """Formulaire de gestion des utilisateurs (cr√©ation/√©dition par admin)"""
    
    password = forms.CharField(
        required=False,
        widget=forms.PasswordInput(attrs={
            'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all',
            'placeholder': 'Nouveau mot de passe (laisser vide pour ne pas modifier)',
        }),
        label="Mot de passe",
        help_text="Minimum 8 caract√®res. Laisser vide pour ne pas modifier."
    )
    
    password_confirm = forms.CharField(
        required=False,
        widget=forms.PasswordInput(attrs={
            'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all',
            'placeholder': 'Confirmer le mot de passe',
        }),
        label="Confirmation du mot de passe"
    )
    
    class Meta:
        model = User
        fields = ['full_name', 'email', 'phone', 'role', 'is_active', 'profile_picture']
        widgets = {
            'full_name': forms.TextInput(attrs={
                'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all',
                'placeholder': 'Nom Pr√©nom(s)'
            }),
            'email': forms.EmailInput(attrs={
                'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all',
                'placeholder': 'email@example.com'
            }),
            'phone': forms.TextInput(attrs={
                'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all',
                'placeholder': '+229 90 00 00 00'
            }),
            'role': forms.Select(attrs={
                'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all'
            }),
            'is_active': forms.CheckboxInput(attrs={
                'class': 'w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-2 focus:ring-purple-500'
            }),
        }
    
    def __init__(self, *args, **kwargs):
        self.is_edit = kwargs.pop('is_edit', False)
        super().__init__(*args, **kwargs)
        
        if self.is_edit:
            # En mode √©dition, le mot de passe n'est pas obligatoire
            self.fields['password'].required = False
            self.fields['password_confirm'].required = False
        else:
            # En mode cr√©ation, le mot de passe est obligatoire
            self.fields['password'].required = True
            self.fields['password_confirm'].required = True
    
    def clean_full_name(self):
        """Valide le format du nom complet"""
        full_name = self.cleaned_data.get('full_name', '').strip()
        full_name = re.sub(r'[<>\"\'&]', '', full_name)
        
        is_valid, normalized_name = User.validate_full_name(full_name)
        
        if not is_valid:
            raise forms.ValidationError(
                'Format invalide. Utilisez: "Nom Pr√©nom", "Nom_Pr√©nom" ou "NomPr√©nom"'
            )
        
        return normalized_name
    
    def clean_email(self):
        """Valide et normalise l'email"""
        email = self.cleaned_data.get('email', '').lower().strip()
        
        email_regex = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
        if not re.match(email_regex, email):
            raise forms.ValidationError('Format d\'adresse e-mail invalide')
        
        # V√©rification d'unicit√© (exclut l'instance actuelle si √©dition)
        if self.instance and self.instance.pk:
            if User.objects.filter(email=email).exclude(pk=self.instance.pk).exists():
                raise forms.ValidationError('Cette adresse e-mail est d√©j√† utilis√©e')
        else:
            if User.objects.filter(email=email).exists():
                raise forms.ValidationError('Cette adresse e-mail est d√©j√† utilis√©e')
        
        return email
    
    def clean_phone(self):
        """Valide le num√©ro de t√©l√©phone"""
        phone = self.cleaned_data.get('phone', '').strip()
        
        # V√©rification d'unicit√© (exclut l'instance actuelle si √©dition)
        if self.instance and self.instance.pk:
            if User.objects.filter(phone=phone).exclude(pk=self.instance.pk).exists():
                raise forms.ValidationError('Ce num√©ro de t√©l√©phone est d√©j√† utilis√©')
        else:
            if User.objects.filter(phone=phone).exists():
                raise forms.ValidationError('Ce num√©ro de t√©l√©phone est d√©j√† utilis√©')
        
        return phone
    
    def clean(self):
        """Validation globale"""
        cleaned_data = super().clean()
        password = cleaned_data.get('password')
        password_confirm = cleaned_data.get('password_confirm')
        
        # Valide le mot de passe si fourni
        if password or password_confirm:
            if password != password_confirm:
                raise forms.ValidationError('Les mots de passe ne correspondent pas')
            
            if password and len(password) < 8:
                raise forms.ValidationError('Le mot de passe doit contenir au moins 8 caract√®res')
        
        # En mode cr√©ation, le mot de passe est obligatoire
        if not self.is_edit and not password:
            raise forms.ValidationError('Le mot de passe est obligatoire pour cr√©er un utilisateur')
        
        return cleaned_data
    
    def save(self, commit=True):
        """Sauvegarde avec hashage du mot de passe"""
        user = super().save(commit=False)
        
        password = self.cleaned_data.get('password')
        if password:
            user.set_password(password)
        
        if commit:
            user.save()
        
        return user

# ============================================================================
# FORMULAIRE DE GESTION DES R√îLES
# ============================================================================

class RoleManagementForm(forms.ModelForm):
    """Formulaire de cr√©ation et modification de r√¥les"""
    
    class Meta:
        model = Role
        fields = ['name', 'display_name']  # Suppression de is_default des champs par d√©faut
        widgets = {
            'name': forms.TextInput(attrs={
                'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all',
                'placeholder': 'ex: manager, editor, viewer',
                'id': 'role_name'
            }),
            'display_name': forms.TextInput(attrs={
                'class': 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all',
                'placeholder': 'ex: Gestionnaire, √âditeur, Observateur',
                'id': 'role_display_name'
            }),
        }
        labels = {
            'name': 'Nom technique du r√¥le',
            'display_name': 'Nom d\'affichage',
        }
        help_texts = {
            'name': 'En minuscules, sans espaces (ex: editor, manager)',
            'display_name': 'Nom convivial affich√© dans l\'interface',
        }
    
    def __init__(self, *args, **kwargs):
        self.is_system_role = kwargs.pop('is_system_role', False)
        super().__init__(*args, **kwargs)
        
        # Si c'est un r√¥le syst√®me, le nom ne peut pas √™tre modifi√©
        if self.is_system_role and self.instance.pk:
            self.fields['name'].widget.attrs['readonly'] = True
            self.fields['name'].help_text = '‚ö†Ô∏è Le nom des r√¥les syst√®me ne peut pas √™tre modifi√©'
        
        # Ajout d'un champ cach√© pour le r√¥le user qui forcera is_default √† True
        if self.instance and self.instance.name == 'user':
            self.fields['is_default'] = forms.BooleanField(
                initial=True,
                required=False,
                widget=forms.HiddenInput()
            )
            # Ajout d'un champ visuel en lecture seule pour indiquer que c'est le r√¥le par d√©faut
            self.fields['default_role_info'] = forms.CharField(
                initial='‚úÖ Ce r√¥le est le r√¥le par d√©faut du syst√®me',
                required=False,
                disabled=True,
                widget=forms.TextInput(attrs={
                    'class': 'w-full px-4 py-3 border-0 bg-gray-50 text-gray-700',
                    'readonly': 'readonly'
                })
            )
            
    def save(self, commit=True):
        instance = super().save(commit=False)
        # Force is_default √† True pour le r√¥le user
        if hasattr(instance, 'name') and instance.name == 'user':
            instance.is_default = True
        
        if commit:
            instance.save()
        return instance
    
    def clean_name(self):
        """Valide le nom du r√¥le"""
        name = self.cleaned_data.get('name', '').strip().lower()
        
        # Protection XSS
        name = re.sub(r'[<>\"\'&]', '', name)
        
        # Validation du format (lettres, chiffres, underscore uniquement)
        if not re.match(r'^[a-z0-9_]+$', name):
            raise forms.ValidationError(
                'Le nom doit contenir uniquement des lettres minuscules, chiffres et underscores'
            )
        
        # V√©rification de longueur
        if len(name) < 2:
            raise forms.ValidationError('Le nom doit contenir au moins 2 caract√®res')
        
        if len(name) > 50:
            raise forms.ValidationError('Le nom ne doit pas d√©passer 50 caract√®res')
        
        # Emp√™cher la cr√©ation de r√¥les avec des noms syst√®me
        if not self.instance.pk and name in ['user', 'superuser']:
            raise forms.ValidationError('Ce nom est r√©serv√© aux r√¥les syst√®me')
        
        # V√©rification d'unicit√© (sauf pour l'instance courante)
        if self.instance.pk:
            if Role.objects.filter(name=name).exclude(pk=self.instance.pk).exists():
                raise forms.ValidationError('Un r√¥le avec ce nom existe d√©j√†')
        else:
            if Role.objects.filter(name=name).exists():
                raise forms.ValidationError('Un r√¥le avec ce nom existe d√©j√†')
        
        return name
    
    def clean_display_name(self):
        """Valide le nom d'affichage"""
        display_name = self.cleaned_data.get('display_name', '').strip()
        
        # Protection XSS
        display_name = re.sub(r'[<>\"\'&]', '', display_name)
        
        if len(display_name) < 2:
            raise forms.ValidationError('Le nom d\'affichage doit contenir au moins 2 caract√®res')
        
        if len(display_name) > 100:
            raise forms.ValidationError('Le nom d\'affichage ne doit pas d√©passer 100 caract√®res')
        
        return display_name
    
    def clean_is_default(self):
        """Valide le champ is_default"""
        is_default = self.cleaned_data.get('is_default', False)
        
        # Le r√¥le superuser ne peut jamais √™tre le r√¥le par d√©faut
        if is_default and self.instance.pk and self.instance.name == 'superuser':
            raise forms.ValidationError('Le r√¥le superuser ne peut pas √™tre le r√¥le par d√©faut')
        
        return is_default
    
    def clean(self):
        """Validation globale"""
        cleaned_data = super().clean()
        is_default = cleaned_data.get('is_default', False)
        
        # Si on d√©finit ce r√¥le comme d√©faut, d√©sactiver les autres
        if is_default:
            # Cette logique sera g√©r√©e dans la vue pour √©viter les conflits
            pass
        
        return cleaned_data

================================================================================
FILE: ./django_authentication/__init__.py
================================================================================



================================================================================
FILE: ./django_authentication/templatetags/profile_tags.py
================================================================================

from django import template
from django.templatetags.static import static

register = template.Library()

@register.filter(name='has_profile_picture')
def has_profile_picture(user):
    """V√©rifie si l'utilisateur a une photo de profil"""
    if not user or not hasattr(user, 'profile_picture'):
        return False
    
    # V√©rifie si le fichier existe r√©ellement
    try:
        return bool(user.profile_picture and user.profile_picture.name)
    except (ValueError, AttributeError):
        return False

@register.simple_tag
def profile_picture_url(user):
    """Retourne l'URL de la photo de profil ou une URL par d√©faut"""
    # V√©rifie d'abord si la m√©thode get_profile_picture_url_safe existe
    if hasattr(user, 'get_profile_picture_url_safe'):
        try:
            url = user.get_profile_picture_url_safe()
            if url:
                return url
        except (ValueError, AttributeError):
            pass
    
    # Sinon, essaie d'acc√©der directement au champ profile_picture
    if hasattr(user, 'profile_picture'):
        try:
            if user.profile_picture and user.profile_picture.name:
                return user.profile_picture.url
        except (ValueError, AttributeError):
            pass
    
    # Si tout √©choue, retourne l'image par d√©faut
    return static('images/default-avatar.svg')


================================================================================
FILE: ./django_authentication/templatetags/__init__.py
================================================================================




================================================================================
FILE: ./django_authentication/templates/home.html
================================================================================

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil - Syst√®me d'Authentification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        .fade-in-delay-1 {
            animation: fadeIn 0.8s ease-out 0.2s forwards;
            opacity: 0;
        }
        
        .fade-in-delay-2 {
            animation: fadeIn 0.8s ease-out 0.4s forwards;
            opacity: 0;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                            üîê AuthSystem
                        </span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <a href="{% url 'login' %}" class="text-gray-700 hover:text-blue-600 font-medium transition-colors">
                        Connexion
                    </a>
                    <a href="{% url 'signup' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-all transform hover:scale-105 shadow-lg">
                        S'inscrire
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
        <div class="grid lg:grid-cols-2 gap-12 items-center">
            <!-- Contenu texte -->
            <div class="text-center lg:text-left">
                <h1 class="text-5xl lg:text-6xl font-bold text-gray-900 mb-6 fade-in">
                    Bienvenue sur
                    <span class="bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        AuthSystem
                    </span>
                </h1>
                <p class="text-xl text-gray-600 mb-8 fade-in-delay-1">
                    Un syst√®me d'authentification moderne, s√©curis√© et professionnel construit avec Django.
                </p>
                
                <!-- Fonctionnalit√©s -->
                <div class="space-y-4 mb-10 fade-in-delay-2">
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mt-1">
                            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900">S√©curit√© renforc√©e</h3>
                            <p class="text-gray-600">Protection CSRF, validation stricte et hashage s√©curis√©</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mt-1">
                            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900">Design moderne</h3>
                            <p class="text-gray-600">Interface intuitive et responsive avec Tailwind CSS</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mt-1">
                            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900">Validation en temps r√©el</h3>
                            <p class="text-gray-600">Feedback instantan√© et indicateur de robustesse</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mt-1">
                            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900">Support international</h3>
                            <p class="text-gray-600">S√©lecteur de pays avec indicatifs t√©l√©phoniques</p>
                        </div>
                    </div>
                </div>

                <!-- Boutons d'action -->
                <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start fade-in-delay-2">
                    <a href="{% url 'signup' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-lg font-medium text-lg transition-all transform hover:scale-105 shadow-lg hover:shadow-xl">
                        Cr√©er un compte
                        <svg class="inline w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                        </svg>
                    </a>
                    <a href="{% url 'login' %}" class="bg-white hover:bg-gray-50 text-gray-800 px-8 py-4 rounded-lg font-medium text-lg transition-all border-2 border-gray-200 hover:border-gray-300">
                        Se connecter
                    </a>
                </div>
            </div>

            <!-- Illustration -->
            <div class="hidden lg:block">
                <div class="relative">
                    <!-- Carte flottante -->
                    <div class="bg-white rounded-2xl shadow-2xl p-8 float-animation">
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">Profil Utilisateur</h3>
                                <p class="text-gray-500 text-sm">Inscription s√©curis√©e</p>
                            </div>
                        </div>
                        
                        <!-- Formulaire fictif -->
                        <div class="space-y-4">
                            <div>
                                <div class="h-10 bg-gray-100 rounded-lg animate-pulse"></div>
                            </div>
                            <div>
                                <div class="h-10 bg-gray-100 rounded-lg animate-pulse"></div>
                            </div>
                            <div>
                                <div class="h-10 bg-gray-100 rounded-lg animate-pulse"></div>
                            </div>
                            <div>
                                <div class="h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- √âl√©ments d√©coratifs -->
                    <div class="absolute -top-4 -right-4 w-24 h-24 bg-purple-200 rounded-full opacity-50 blur-2xl"></div>
                    <div class="absolute -bottom-4 -left-4 w-32 h-32 bg-blue-200 rounded-full opacity-50 blur-2xl"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistiques -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="text-center p-8 bg-white rounded-xl shadow-lg">
                <div class="text-4xl font-bold text-blue-600 mb-2">100%</div>
                <div class="text-gray-600">S√©curis√©</div>
            </div>
            <div class="text-center p-8 bg-white rounded-xl shadow-lg">
                <div class="text-4xl font-bold text-purple-600 mb-2">5+</div>
                <div class="text-gray-600">Crit√®res de validation</div>
            </div>
            <div class="text-center p-8 bg-white rounded-xl shadow-lg">
                <div class="text-4xl font-bold text-green-600 mb-2">20+</div>
                <div class="text-gray-600">Pays support√©s</div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="text-center">
                <p class="text-gray-400">
                    ¬© 2025 AuthSystem. Construit avec Django & Tailwind CSS.
                </p>
                <p class="text-gray-500 text-sm mt-2">
                    Syst√®me d'authentification moderne et s√©curis√©
                </p>
            </div>
        </div>
    </footer>
</body>
</html>


================================================================================
FILE: ./django_authentication/templates/components/sidebar.html
================================================================================

{% load static %}
{% load profile_tags %}

<!-- Sidebar Component -->
<aside class="sidebar-component w-64 bg-white border-r border-gray-200 flex flex-col h-screen fixed left-0 top-0 z-40">
    <!-- Header avec profil -->
    <div class="p-6 border-b border-gray-200">
        <!-- Avatar et info -->
        <div class="flex items-center gap-3 mb-4">
            <div class="relative group">
                {% if user|has_profile_picture %}
                    <img 
                        id="sidebar-avatar-img" 
                        src="{% profile_picture_url user %}" 
                        alt="{{ user.full_name }}"
                        class="w-14 h-14 rounded-full object-cover ring-2 ring-gray-200 transition-all group-hover:ring-blue-500"
                    >
                {% else %}
                    <div 
                        id="sidebar-avatar-initials" 
                        class="w-14 h-14 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-lg ring-2 ring-gray-200 transition-all group-hover:ring-blue-500"
                    >
                        {{ user.get_initials }}
                    </div>
                {% endif %}
                
                <!-- Badge de statut -->
                <div class="absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"></div>
            </div>
            
            <div class="flex-1 min-w-0">
                <h3 id="sidebar-user-name" class="font-semibold text-gray-900 truncate">{{ user.full_name }}</h3>
                <p class="text-xs text-gray-500 capitalize">{{ user.role }}</p>
            </div>
        </div>
            
            <!-- Bouton Modifier -->
            <button 
                id="edit-profile-btn"
                type="button"
                class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-lg transition-all duration-200 border border-gray-200 hover:border-gray-300 group"
            >
                <svg class="w-4 h-4 text-gray-500 group-hover:text-blue-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                <span class="text-sm font-medium">Modifier le profil</span>
            </button>
        </div>
    
    <!-- Navigation -->
    <nav class="flex-1 p-4 overflow-y-auto">
        <div class="space-y-1">
            <!-- Dashboard -->
            <a href="{% if user.role == 'superuser' %}{% url 'superuser_dashboard' %}{% else %}{% url 'user_dashboard' %}{% endif %}" 
               class="nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-all group {% if request.resolver_match.url_name == 'user_dashboard' or request.resolver_match.url_name == 'superuser_dashboard' %}bg-blue-50 text-blue-600{% endif %}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                <span class="font-medium">Tableau de bord</span>
            </a>
            
            {% if user.role.name == 'superuser' %}
            <!-- Menu admin -->
            <div class="space-y-1">
                <a href="{% url 'user_management' %}" 
                class="nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-all group {% if 'gestion-utilisateurs' in request.path %}bg-blue-50 text-blue-600{% endif %}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                    <span class="font-medium">G√©rer les utilisateurs</span>
                </a>

                <a href="{% url 'manage_roles' %}" 
                class="nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-all group {% if 'gestion-roles' in request.path %}bg-blue-50 text-blue-600{% endif %}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                    </svg>
                    <span class="font-medium">G√©rer les r√¥les</span>
                </a>
                
                <a href="/admin/" target="_blank" class="nav-link flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-all group">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span class="font-medium">Admin Django</span>
                </a>
            </div>
            {% endif %}
        </div>
    </nav>
    
    <!-- Footer -->
    <div class="p-4 border-t border-gray-200">
        <form method="POST" action="{% url 'logout' %}" id="logout-form">
            {% csrf_token %}
            <input type="hidden" name="next" value="{% url 'login' %}">
            <button 
                type="submit"
                class="w-full flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-all group"
            >
                <svg class="w-5 h-5 text-gray-500 group-hover:text-red-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
                <span class="font-medium text-gray-700 group-hover:text-red-600 transition-colors">D√©connexion</span>
            </button>
        </form>
    </div>
</aside>

<!-- Modale de modification du profil -->
<div id="profile-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden animate-slide-in">
        <!-- Header -->
        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
            <h2 class="text-2xl font-bold text-gray-900">Modifier mon profil</h2>
            <button 
                type="button" 
                id="close-modal-btn"
                class="text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-lg"
            >
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <!-- Body -->
        <div class="px-6 py-6 overflow-y-auto max-h-[calc(90vh-140px)]">
            <form id="profile-form" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- Photo de profil -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Photo de profil</label>
                    <div class="flex items-center gap-6">
                        <!-- Preview -->
                        <div class="relative">
                            {% if user|has_profile_picture %}
                            <img 
                                id="modal-avatar-preview-img" 
                                src="{% profile_picture_url user %}" 
                                alt="{{ user.full_name }}"
                                class="w-24 h-24 rounded-full object-cover ring-4 ring-gray-200"
                            >
                            <div id="modal-avatar-preview-initials" class="w-24 h-24 rounded-full bg-gradient-to-br from-blue-400 to-purple-600 flex items-center justify-center text-white text-2xl font-bold hidden">
                                {{ user.get_initials }}
                            </div>
                        {% else %}
                            <img 
                                id="modal-avatar-preview-img" 
                                src="" 
                                alt=""
                                class="w-24 h-24 rounded-full object-cover ring-4 ring-gray-200 hidden"
                            >
                            <div id="modal-avatar-preview-initials" class="w-24 h-24 rounded-full bg-gradient-to-br from-blue-400 to-purple-600 flex items-center justify-center text-white text-2xl font-bold">
                                {{ user.get_initials }}
                            </div>
                        {% endif %}
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex-1 space-y-2">
                            <input 
                                type="file" 
                                id="profile-picture-input" 
                                name="profile_picture"
                                accept="image/jpeg,image/png,image/jpg,image/gif,image/webp"
                                class="hidden"
                            >
                            
                            <button 
                                type="button"
                                id="upload-photo-btn"
                                class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all font-medium text-sm"
                            >
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                {% if user|has_profile_picture %}Changer la photo{% else %}D√©finir la photo{% endif %}
                            </button>
                            
                            <button 
                                type="button"
                                id="delete-photo-btn"
                                class="text-sm text-red-600 hover:text-red-700 font-medium {% if not user|has_profile_picture %}hidden{% endif %}"
                            >
                                Supprimer la photo
                            </button>
                            
                            <p class="text-xs text-gray-500">JPG, PNG, GIF ou WEBP. Max 5MB.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Nom complet -->
                <div class="mb-5">
                    <label for="modal-full-name" class="block text-sm font-medium text-gray-700 mb-2">
                        Nom complet
                    </label>
                    <input 
                        type="text" 
                        id="modal-full-name" 
                        name="full_name"
                        value="{{ user.full_name }}"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                        required
                    >
                    <p id="error-full-name" class="mt-1 text-sm text-red-600 hidden"></p>
                </div>
                
                <!-- Email -->
                <div class="mb-5">
                    <label for="modal-email" class="block text-sm font-medium text-gray-700 mb-2">
                        Adresse e-mail
                    </label>
                    <input 
                        type="email" 
                        id="modal-email" 
                        name="email"
                        value="{{ user.email }}"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                        required
                    >
                    <p id="error-email" class="mt-1 text-sm text-red-600 hidden"></p>
                </div>
                
                <!-- T√©l√©phone -->
                <div class="mb-5">
                    <label for="modal-phone" class="block text-sm font-medium text-gray-700 mb-2">
                        Num√©ro de t√©l√©phone
                    </label>
                    <input 
                        type="tel" 
                        id="modal-phone" 
                        name="phone"
                        value="{{ user.phone }}"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                        required
                    >
                    <p id="error-phone" class="mt-1 text-sm text-red-600 hidden"></p>
                </div>
            </form>
        </div>
        
        <!-- Footer -->
        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-end gap-3 bg-gray-50">
            <button 
                type="button" 
                id="cancel-modal-btn"
                class="px-6 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium"
            >
                Annuler
            </button>
            <button 
                type="submit" 
                form="profile-form"
                id="save-profile-btn"
                class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all font-medium flex items-center gap-2"
            >
                <span id="save-text">Enregistrer</span>
                <span id="save-loader" class="hidden">
                    <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </span>
            </button>
        </div>
    </div>
</div>

<!-- Toast de notification -->
<div id="toast-notification" class="hidden fixed top-4 right-4 z-50 animate-slide-in">
    <div class="bg-white rounded-lg shadow-xl border border-gray-200 p-4 flex items-center gap-3 min-w-[300px]">
        <div id="toast-icon" class="flex-shrink-0"></div>
        <div class="flex-1">
            <p id="toast-message" class="text-sm font-medium text-gray-900"></p>
        </div>
        <button type="button" id="close-toast-btn" class="flex-shrink-0 text-gray-400 hover:text-gray-600">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>
</div>

<style>
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-slide-in {
    animation: slideIn 0.3s ease-out;
}

.nav-link {
    position: relative;
}

.nav-link::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 3px;
    height: 0;
    background: linear-gradient(to bottom, #3B82F6, #8B5CF6);
    border-radius: 0 3px 3px 0;
    transition: height 0.2s ease;
}

.nav-link:hover::before,
.nav-link.bg-blue-50::before {
    height: 60%;
}
</style>

<script src="{% static 'js/profile.js' %}"></script>


================================================================================
FILE: ./django_authentication/templates/registration/reset_password.html
================================================================================

{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©initialisation du mot de passe</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <div class="text-center mb-8">
                <div class="inline-block p-3 bg-orange-100 rounded-full mb-4">
                    <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">R√©initialisation</h1>
                <p class="text-gray-600">Fonctionnalit√© √† venir</p>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <p class="text-blue-800 text-sm">
                    La fonctionnalit√© de r√©initialisation de mot de passe sera bient√¥t disponible.
                </p>
            </div>

            <a href="{% url 'login' %}" class="block w-full bg-blue-600 hover:bg-blue-700 text-white text-center py-3 px-6 rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl">
                Retour √† la connexion
            </a>
        </div>
    </div>
</body>
</html>


================================================================================
FILE: ./django_authentication/templates/registration/signup.html
================================================================================

{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription - Syst√®me d'Authentification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .password-strength-bar {
            transition: all 0.3s ease;
        }
        
        .tooltip {
            display: none;
            position: absolute;
            z-index: 1000;
        }
        
        .tooltip.show {
            display: block;
        }
        
        .country-dropdown {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .country-option:hover {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <!-- Carte principale -->
        <div class="bg-white rounded-2xl shadow-2xl p-8 animate-slide-in">
            <!-- En-t√™te -->
            <div class="text-center mb-8">
                <div class="inline-block p-3 bg-blue-100 rounded-full mb-4">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Inscription</h1>
                <p class="text-gray-600">Cr√©ez votre compte en quelques instants</p>
            </div>

            <!-- Messages d'erreur/succ√®s Django -->
            {% if messages %}
                {% for message in messages %}
                <div class="mb-4 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% else %}bg-red-50 text-red-800 border border-red-200{% endif %}">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}

            <!-- Formulaire -->
            <form method="POST" action="{% url 'signup' %}" id="signup-form" novalidate>
                {% csrf_token %}

                <!-- Nom complet -->
                <div class="mb-5">
                    <label for="{{ form.full_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        {{ form.full_name.label }}
                    </label>
                    {{ form.full_name }}
                    {% if form.full_name.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.full_name.errors.0 }}</p>
                    {% endif %}
                    <p class="mt-1 text-xs text-gray-500">Format: Nom Pr√©nom, Nom_Pr√©nom ou NomPr√©nom</p>
                </div>

                <!-- Email -->
                <div class="mb-5">
                    <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        {{ form.email.label }}
                    </label>
                    {{ form.email }}
                    {% if form.email.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- T√©l√©phone avec s√©lecteur de pays -->
                <div class="mb-5">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Num√©ro de t√©l√©phone
                    </label>
                    <div class="flex gap-2">
                        <!-- S√©lecteur de pays -->
                        <div class="relative flex-shrink-0" style="width: 120px;">
                            <button type="button" id="country-selector-btn" class="w-full px-3 py-3 border border-gray-300 rounded-lg bg-white hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all flex items-center justify-between">
                                <span id="selected-country" class="flex items-center text-sm">
                                    <span class="mr-1">üáßüáØ</span>
                                    <span>+229</span>
                                </span>
                                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            <!-- Dropdown des pays -->
                            <div id="country-dropdown" class="hidden absolute top-full left-0 mt-1 w-64 bg-white border border-gray-200 rounded-lg shadow-xl z-50">
                                <div class="p-2">
                                    <input type="text" id="country-search" placeholder="Rechercher..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                                </div>
                                <div class="country-dropdown">
                                    {% for country in countries %}
                                    <div class="country-option px-4 py-2 cursor-pointer flex items-center text-sm" data-code="{{ country.code }}" data-flag="{{ country.flag }}">
                                        <span class="mr-2">{{ country.flag }}</span>
                                        <span class="flex-1">{{ country.name }}</span>
                                        <span class="text-gray-500">{{ country.code }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <!-- Champ num√©ro -->
                        <div class="flex-1">
                            {{ form.phone_number }}
                            {{ form.country_code }}
                        </div>
                    </div>
                    {% if form.phone_number.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.phone_number.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Mot de passe avec indicateur de robustesse -->
                <div class="mb-5 relative">
                    <label for="{{ form.password.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        {{ form.password.label }}
                    </label>
                    {{ form.password }}
                    
                    <!-- Barre de robustesse -->
                    <div class="mt-2">
                        <div class="flex items-center gap-2 mb-1">
                            <div class="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div id="strength-bar" class="password-strength-bar h-full w-0 bg-red-500 rounded-full"></div>
                            </div>
                            <span id="strength-text" class="text-xs font-medium text-gray-500">-</span>
                        </div>
                        
                        <!-- Crit√®res -->
                        <div id="password-criteria" class="text-xs space-y-1 mt-2 p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center gap-2">
                                <span id="criteria-length" class="text-gray-400">‚óã</span>
                                <span class="text-gray-600">Au moins 8 caract√®res</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span id="criteria-upper" class="text-gray-400">‚óã</span>
                                <span class="text-gray-600">Une majuscule</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span id="criteria-lower" class="text-gray-400">‚óã</span>
                                <span class="text-gray-600">Une minuscule</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span id="criteria-number" class="text-gray-400">‚óã</span>
                                <span class="text-gray-600">Un chiffre</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span id="criteria-special" class="text-gray-400">‚óã</span>
                                <span class="text-gray-600">Un caract√®re sp√©cial</span>
                            </div>
                        </div>
                    </div>
                    
                    {% if form.password.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.password.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Confirmation mot de passe -->
                <div class="mb-5">
                    <label for="{{ form.password_confirm.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        {{ form.password_confirm.label }}
                    </label>
                    <div class="relative">
                        {{ form.password_confirm }}
                        <div id="match-indicator" class="hidden absolute right-3 top-1/2 transform -translate-y-1/2">
                            <span id="match-icon"></span>
                        </div>
                    </div>
                    {% if form.password_confirm.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.password_confirm.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Case √† cocher -->
                <div class="mb-6">
                    <label class="flex items-start gap-3 cursor-pointer">
                        {{ form.accept_terms }}
                        <span class="text-sm text-gray-600 leading-relaxed">
                            J'accepte les <a href="#" class="text-blue-600 hover:text-blue-700 font-medium">conditions d'utilisation</a> et la <a href="#" class="text-blue-600 hover:text-blue-700 font-medium">politique de confidentialit√©</a>
                        </span>
                    </label>
                    {% if form.accept_terms.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.accept_terms.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Bouton de soumission -->
                <button type="submit" id="submit-btn" disabled class="w-full bg-gray-400 text-white py-3 px-6 rounded-lg font-medium transition-all duration-200 cursor-not-allowed opacity-50">
                    <span id="submit-text">S'inscrire</span>
                    <span id="submit-loader" class="hidden">
                        <svg class="inline w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Inscription en cours...
                    </span>
                </button>
            </form>

            <!-- Lien de connexion -->
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-600">
                    Avez-vous d√©j√† un compte ? 
                    <a href="{% url 'login' %}" class="text-blue-600 hover:text-blue-700 font-medium transition-colors">Connectez-vous</a>
                </p>
            </div>
        </div>
    </div>

    <script src="{% static 'js/signup.js' %}"></script>
</body>
</html>


================================================================================
FILE: ./django_authentication/templates/registration/login.html
================================================================================

{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion - Syst√®me d'Authentification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .password-toggle {
            cursor: pointer;
            user-select: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <!-- Carte principale -->
        <div class="bg-white rounded-2xl shadow-2xl p-8 animate-slide-in">
            <!-- En-t√™te -->
            <div class="text-center mb-8">
                <div class="inline-block p-3 bg-blue-100 rounded-full mb-4">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Connexion</h1>
                <p class="text-gray-600">Acc√©dez √† votre compte</p>
            </div>

            <!-- Messages d'erreur/succ√®s Django -->
            {% if messages %}
                {% for message in messages %}
                <div class="mb-4 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %}">
                    <div class="flex items-start">
                        {% if message.tags == 'success' %}
                        <svg class="w-5 h-5 mr-2 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        {% elif message.tags == 'error' %}
                        <svg class="w-5 h-5 mr-2 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                        </svg>
                        {% endif %}
                        <span>{{ message }}</span>
                    </div>
                </div>
                {% endfor %}
            {% endif %}

            {% if locked_out %}
            <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                <div class="flex items-center">
                    <svg class="w-5 h-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="text-red-800 font-medium">Compte temporairement verrouill√©</span>
                </div>
            </div>
            {% endif %}

            <!-- Formulaire -->
            <form method="POST" action="{% url 'login' %}" id="login-form" novalidate>
                {% csrf_token %}

                <!-- Email -->
                <div class="mb-5">
                    <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        {{ form.email.label }}
                    </label>
                    {{ form.email }}
                    {% if form.email.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Mot de passe -->
                <div class="mb-5">
                    <label for="{{ form.password.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        {{ form.password.label }}
                    </label>
                    <div class="relative">
                        {{ form.password }}
                        <button type="button" id="toggle-password" class="password-toggle absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors">
                            <svg id="eye-open" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            <svg id="eye-closed" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                            </svg>
                        </button>
                    </div>
                    {% if form.password.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.password.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Erreurs non-field -->
                {% if form.non_field_errors %}
                    <div class="mb-5 p-3 bg-red-50 border border-red-200 rounded-lg">
                        {% for error in form.non_field_errors %}
                            <p class="text-sm text-red-600">{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}

                <!-- Se souvenir de moi & Mot de passe oubli√© -->
                <div class="flex items-center justify-between mb-6">
                    <label class="flex items-center gap-2 cursor-pointer">
                        {{ form.remember_me }}
                        <span class="text-sm text-gray-600">{{ form.remember_me.label }}</span>
                    </label>
                    <a href="{% url 'reset_password' %}" class="text-sm text-blue-600 hover:text-blue-700 font-medium transition-colors">
                        Mot de passe oubli√© ?
                    </a>
                </div>

                <!-- Bouton de soumission -->
                <button type="submit" id="submit-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5" {% if locked_out %}disabled{% endif %}>
                    <span id="submit-text">Se connecter</span>
                    <span id="submit-loader" class="hidden">
                        <svg class="inline w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Connexion en cours...
                    </span>
                </button>
            </form>

            <!-- Lien d'inscription -->
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-600">
                    Vous n'√™tes pas enregistr√© ? 
                    <a href="{% url 'signup' %}" class="text-blue-600 hover:text-blue-700 font-medium transition-colors">Inscrivez-vous</a>
                </p>
            </div>
        </div>

        <!-- Lien retour accueil -->
        <div class="text-center mt-6">
            <a href="{% url 'home' %}" class="text-sm text-gray-600 hover:text-gray-800 transition-colors inline-flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Retour √† l'accueil
            </a>
        </div>
    </div>

    <script src="{% static 'js/login.js' %}"></script>
</body>
</html>


================================================================================
FILE: ./django_authentication/templates/dashboards/superuser_dashboard.html
================================================================================

{% load static %}
{% load profile_tags %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - AuthSystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        .main-content {
            margin-left: 256px;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        @media (max-width: 768px) {
            .sidebar-component {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar-component.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        
        .scale-in {
            animation: scaleIn 0.5s ease-out forwards;
        }
        
        .stat-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transition: left 0.5s;
        }
        
        .stat-card:hover::before {
            left: 100%;
        }
        
        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse-ring {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(1.1);
            }
        }
        
        .gradient-border {
            position: relative;
            background: white;
            border-radius: 1rem;
        }
        
        .gradient-border::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 1rem;
            padding: 2px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }
        
        .loading-skeleton {
            background: linear-gradient(
                90deg,
                #f0f0f0 25%,
                #e0e0e0 50%,
                #f0f0f0 75%
            );
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    {% include 'components/sidebar.html' %}
    
    <!-- Bouton menu mobile -->
    <button id="mobile-menu-btn" class="md:hidden fixed top-4 left-4 z-30 p-2 bg-white rounded-lg shadow-lg">
        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
    
    <!-- Contenu principal -->
    <div class="main-content">
        <!-- Header avec effet glassmorphism -->
        <header class="sticky top-0 z-20 backdrop-blur-lg bg-white/10 border-b border-white/20">
            <div class="px-8 py-6">
                <div class="flex items-center justify-between">
                    <div class="fade-in-up" style="animation-delay: 0.1s;">
                        <h1 class="text-4xl font-black text-white mb-2 drop-shadow-lg">
                            Tableau de bord administrateur
                        </h1>
                        <p class="text-white/90 text-lg">Vue d'ensemble en temps r√©el du syst√®me</p>
                    </div>
                    
                    <div class="flex items-center gap-3 fade-in-up" style="animation-delay: 0.2s;">
                        <!-- Bouton refresh -->
                        <button 
                            id="refresh-stats-btn"
                            class="p-3 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all backdrop-blur-sm border border-white/20 hover:scale-110"
                            title="Actualiser les statistiques"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Contenu -->
        <main class="p-8">
            <!-- Messages Django -->
            {% if messages %}
                {% for message in messages %}
                <div class="mb-6 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %} fade-in-up shadow-lg">
                    <div class="flex items-center">
                        {% if message.tags == 'success' %}
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        {% elif message.tags == 'error' %}
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                        </svg>
                        {% endif %}
                        {{ message }}
                    </div>
                </div>
                {% endfor %}
            {% endif %}
            
            <!-- Zone de statistiques en temps r√©el -->
            <div class="mb-8">
                <!-- Derni√®re mise √† jour -->
                <div class="flex items-center justify-between mb-6 fade-in-up" style="animation-delay: 0.3s;">
                    <div class="flex items-center gap-3 text-white/90">
                        <div class="relative">
                            <div class="w-3 h-3 bg-green-400 rounded-full pulse-ring"></div>
                            <div class="absolute inset-0 w-3 h-3 bg-green-400 rounded-full"></div>
                        </div>
                        <span class="text-sm font-medium">Donn√©es en temps r√©el</span>
                    </div>
                    <div class="text-white/70 text-sm">
                        Derni√®re mise √† jour : <span id="last-update-time">{{ "now"|date:"H:i:s" }}</span>
                    </div>
                </div>
                
                <!-- Grille de statistiques -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                    <!-- Total utilisateurs -->
                    <div class="stat-card gradient-border bg-white rounded-xl p-6 shadow-xl scale-in" style="animation-delay: 0.1s;">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-4 bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl">
                                <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                            </div>
                        </div>
                        <h3 class="text-gray-500 text-sm font-semibold mb-2 uppercase tracking-wider">Total utilisateurs</h3>
                        <p class="stat-number" id="stat-total">{{ stats.total_users }}</p>
                        <div class="mt-3 flex items-center text-xs text-gray-500">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                            Tous r√¥les confondus
                        </div>
                    </div>
                    
                    <!-- Utilisateurs standards -->
                    <div class="stat-card gradient-border bg-white rounded-xl p-6 shadow-xl scale-in" style="animation-delay: 0.2s;">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-4 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl">
                                <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </div>
                        </div>
                        <h3 class="text-gray-500 text-sm font-semibold mb-2 uppercase tracking-wider">Utilisateurs</h3>
                        <p class="stat-number" id="stat-users">{{ stats.regular_users }}</p>
                        <div class="mt-3 flex items-center text-xs text-gray-500">
                            <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full font-semibold">R√¥le: User</span>
                        </div>
                    </div>
                    
                    <!-- Superusers -->
                    <div class="stat-card gradient-border bg-white rounded-xl p-6 shadow-xl scale-in" style="animation-delay: 0.3s;">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-4 bg-gradient-to-br from-orange-100 to-orange-200 rounded-xl">
                                <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                </svg>
                            </div>
                        </div>
                        <h3 class="text-gray-500 text-sm font-semibold mb-2 uppercase tracking-wider">Superusers</h3>
                        <p class="stat-number" id="stat-superusers">{{ stats.superusers }}</p>
                        <div class="mt-3 flex items-center text-xs text-gray-500">
                            <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded-full font-semibold">Acc√®s admin</span>
                        </div>
                    </div>
                    
                    <!-- Actifs -->
                    <div class="stat-card gradient-border bg-white rounded-xl p-6 shadow-xl scale-in" style="animation-delay: 0.4s;">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-4 bg-gradient-to-br from-green-100 to-green-200 rounded-xl">
                                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                        <h3 class="text-gray-500 text-sm font-semibold mb-2 uppercase tracking-wider">Comptes actifs</h3>
                        <p class="stat-number" id="stat-active">{{ stats.active_users }}</p>
                        <div class="mt-3 flex items-center text-xs text-green-600">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            Op√©rationnels
                        </div>
                    </div>
                    
                    <!-- Inactifs -->
                    <div class="stat-card gradient-border bg-white rounded-xl p-6 shadow-xl scale-in" style="animation-delay: 0.5s;">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-4 bg-gradient-to-br from-red-100 to-red-200 rounded-xl">
                                <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path>
                                </svg>
                            </div>
                        </div>
                        <h3 class="text-gray-500 text-sm font-semibold mb-2 uppercase tracking-wider">Comptes inactifs</h3>
                        <p class="stat-number" id="stat-inactive">{{ stats.inactive_users }}</p>
                        <div class="mt-3 flex items-center text-xs text-red-600">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                            </svg>
                            D√©sactiv√©s
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Zone extensible pour futurs widgets -->
            <div id="additional-widgets-zone" class="space-y-6">
                <!-- Message informatif pour d√©veloppement futur -->
                <div class="gradient-border bg-white rounded-xl p-8 shadow-xl text-center fade-in-up" style="animation-delay: 0.6s;">
                    <div class="inline-block p-4 bg-gradient-to-br from-purple-100 to-blue-100 rounded-full mb-4">
                        <svg class="w-12 h-12 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Zone extensible</h3>
                    <p class="text-gray-600 max-w-2xl mx-auto">
                        Cette zone est con√ßue pour accueillir de futurs widgets et fonctionnalit√©s.
                        L'architecture modulaire permet d'ajouter facilement de nouveaux composants sans modifier le code existant.
                    </p>
                </div>
            </div>
        </main>
    </div>
    
    <script src="{% static 'js/superuser-dashboard.js' %}"></script>
    <script>
        // Menu mobile
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.querySelector('.sidebar-component');
        
        if (mobileMenuBtn && sidebar) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });
            
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }
    </script>
</body>
</html>

================================================================================
FILE: ./django_authentication/templates/dashboards/user_dashboard.html
================================================================================

{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - AuthSystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        .main-content {
            margin-left: 256px;
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            .sidebar-component {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar-component.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    {% include 'components/sidebar.html' %}
    
    <!-- Bouton menu mobile -->
    <button id="mobile-menu-btn" class="md:hidden fixed top-4 left-4 z-30 p-2 bg-white rounded-lg shadow-lg">
        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
    
    <!-- Contenu principal -->
    <div class="main-content">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 sticky top-0 z-20">
            <div class="px-8 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Tableau de bord</h1>
                        <p class="text-gray-600 mt-1">Vue d'ensemble de votre activit√©</p>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <!-- Notifications -->
                        <button class="relative p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                        </button>
                        
                        <!-- Recherche -->
                        <button class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-all">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Contenu -->
        <main class="p-8">
            <!-- Message de bienvenue -->
            <div class="mb-8 fade-in">
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl p-8 text-white shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold mb-2">Bienvenue {{ user.full_name }} sur votre tableau de bord usager</h2>
                            <p class="text-blue-100">G√©rez votre compte et vos activit√©s depuis cet espace personnalis√©</p>
                        </div>
                        <div class="hidden lg:block">
                            <svg class="w-24 h-24 text-white opacity-20" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Menu mobile
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.querySelector('.sidebar-component');
        
        if (mobileMenuBtn && sidebar) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });
            
            // Fermer au clic ext√©rieur
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }
    </script>
</body>
</html>



================================================================================
FILE: ./django_authentication/templates/admin/user_form.html
================================================================================

{% load static %}
{% load profile_tags %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - AuthSystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        .main-content {
            margin-left: 256px;
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            .sidebar-component {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar-component.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    {% include 'components/sidebar.html' %}
    
    <!-- Bouton menu mobile -->
    <button id="mobile-menu-btn" class="md:hidden fixed top-4 left-4 z-30 p-2 bg-white rounded-lg shadow-lg">
        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
    
    <!-- Contenu principal -->
    <div class="main-content">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 sticky top-0 z-20">
            <div class="px-8 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">{{ page_title }}</h1>
                        <p class="text-gray-600 mt-1">
                            {% if is_edit %}
                                Modifiez les informations de l'utilisateur
                            {% else %}
                                Cr√©ez un nouveau compte utilisateur
                            {% endif %}
                        </p>
                    </div>
                    
                    <a href="{% url 'user_management' %}" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-all flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Retour √† la liste
                    </a>
                </div>
            </div>
        </header>
        
        <!-- Contenu -->
        <main class="p-8">
            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                <div class="mb-6 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %} fade-in">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
            
            <!-- Formulaire -->
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 fade-in">
                    <form method="POST" enctype="multipart/form-data" id="user-form">
                        {% csrf_token %}
                        
                        <!-- Erreurs globales -->
                        {% if form.non_field_errors %}
                            <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                                {% for error in form.non_field_errors %}
                                    <p class="text-sm text-red-600">{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                        
                        <!-- Section Photo de profil -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Photo de profil</h3>
                            <div class="flex items-center gap-6">
                                <!-- Preview -->
                                <div class="relative">
                                    {% if is_edit and user_to_edit|has_profile_picture %}
                                        <img 
                                            id="profile-preview" 
                                            src="{% profile_picture_url user_to_edit %}" 
                                            alt="Preview"
                                            class="w-24 h-24 rounded-full object-cover ring-4 ring-gray-200"
                                        >
                                    {% else %}
                                        <div 
                                            id="profile-preview-initials" 
                                            class="w-24 h-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-2xl ring-4 ring-gray-200"
                                        >
                                            {% if is_edit %}{{ user_to_edit.get_initials }}{% else %}??{% endif %}
                                        </div>
                                        <img 
                                            id="profile-preview" 
                                            src="" 
                                            alt="Preview"
                                            class="w-24 h-24 rounded-full object-cover ring-4 ring-gray-200 hidden"
                                        >
                                    {% endif %}
                                </div>
                                
                                <!-- Actions -->
                                <div class="flex-1">
                                    {{ form.profile_picture }}
                                    <button 
                                        type="button"
                                        onclick="document.getElementById('id_profile_picture').click()"
                                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all font-medium text-sm"
                                    >
                                        Choisir une photo
                                    </button>
                                    <p class="text-xs text-gray-500 mt-2">JPG, PNG, GIF ou WEBP. Max 5MB.</p>
                                    {% if form.profile_picture.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.profile_picture.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section Informations personnelles -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Informations personnelles</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Nom complet -->
                                <div class="md:col-span-2">
                                    <label for="{{ form.full_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.full_name.label }} <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.full_name }}
                                    {% if form.full_name.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.full_name.errors.0 }}</p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">Format: Nom Pr√©nom, Nom_Pr√©nom ou NomPr√©nom</p>
                                </div>
                                
                                <!-- Email -->
                                <div>
                                    <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.email.label }} <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.email }}
                                    {% if form.email.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
                                    {% endif %}
                                </div>
                                
                                <!-- T√©l√©phone -->
                                <div>
                                    <label for="{{ form.phone.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.phone.label }} <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.phone }}
                                    {% if form.phone.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.phone.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section S√©curit√© -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">
                                {% if is_edit %}Modifier le mot de passe{% else %}Mot de passe{% endif %}
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Mot de passe -->
                                <div>
                                    <label for="{{ form.password.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.password.label }} {% if not is_edit %}<span class="text-red-500">*</span>{% endif %}
                                    </label>
                                    {{ form.password }}
                                    {% if form.password.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.password.errors.0 }}</p>
                                    {% endif %}
                                    {% if is_edit %}
                                        <p class="mt-1 text-xs text-gray-500">Laisser vide pour ne pas modifier</p>
                                    {% endif %}
                                </div>
                                
                                <!-- Confirmation -->
                                <div>
                                    <label for="{{ form.password_confirm.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.password_confirm.label }} {% if not is_edit %}<span class="text-red-500">*</span>{% endif %}
                                    </label>
                                    {{ form.password_confirm }}
                                    {% if form.password_confirm.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.password_confirm.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section R√¥le et Statut -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">R√¥le et statut</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- R√¥le -->
                                <div>
                                    <label for="{{ form.role.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.role.label }} <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.role }}
                                    {% if form.role.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.role.errors.0 }}</p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">Superuser = acc√®s administrateur complet</p>
                                </div>
                                
                                <!-- Statut actif -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Statut du compte
                                    </label>
                                    <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg">
                                        {{ form.is_active }}
                                        <label for="{{ form.is_active.id_for_label }}" class="text-sm text-gray-700 cursor-pointer">
                                            Compte actif
                                        </label>
                                    </div>
                                    {% if form.is_active.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.is_active.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Boutons d'action -->
                        <div class="flex items-center justify-end gap-4 pt-6 border-t border-gray-200">
                            <a href="{% url 'user_management' %}" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-all">
                                Annuler
                            </a>
                            <button type="submit" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-all shadow-lg hover:shadow-xl flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                {% if is_edit %}Modifier{% else %}Cr√©er{% endif %} l'utilisateur
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Menu mobile
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.querySelector('.sidebar-component');
        
        if (mobileMenuBtn && sidebar) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });
            
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }
        
        // Pr√©visualisation de la photo
        const profilePictureInput = document.getElementById('id_profile_picture');
        const profilePreview = document.getElementById('profile-preview');
        const profilePreviewInitials = document.getElementById('profile-preview-initials');
        
        if (profilePictureInput) {
            profilePictureInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profilePreview.src = e.target.result;
                        profilePreview.classList.remove('hidden');
                        if (profilePreviewInitials) {
                            profilePreviewInitials.classList.add('hidden');
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    </script>
</body>
</html>

================================================================================


================================================================================
FILE: ./django_authentication/templates/admin/role_form.html
================================================================================

{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - AuthSystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        .main-content {
            margin-left: 256px;
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            .sidebar-component {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar-component.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    {% include 'components/sidebar.html' %}
    
    <!-- Bouton menu mobile -->
    <button id="mobile-menu-btn" class="md:hidden fixed top-4 left-4 z-30 p-2 bg-white rounded-lg shadow-lg">
        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
    
    <!-- Contenu principal -->
    <div class="main-content">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 sticky top-0 z-20">
            <div class="px-8 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">{{ page_title }}</h1>
                        <p class="text-gray-600 mt-1">
                            {% if is_edit %}
                                {% if is_system_role %}
                                Modifiez les informations du r√¥le syst√®me
                                {% else %}
                                Modifiez les informations du r√¥le personnalis√©
                                {% endif %}
                            {% else %}
                                Cr√©ez un nouveau r√¥le personnalis√©
                            {% endif %}
                        </p>
                    </div>
                    
                    <a href="{% url 'manage_roles' %}" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-all flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Retour √† la liste
                    </a>
                </div>
            </div>
        </header>
        
        <!-- Contenu -->
        <main class="p-8">
            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                <div class="mb-6 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %} fade-in">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
            
            <!-- Avertissement pour r√¥le syst√®me -->
            {% if is_system_role %}
            <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg fade-in">
                <div class="flex items-start">
                    <svg class="w-6 h-6 text-yellow-600 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                    <div>
                        <h3 class="text-yellow-900 font-semibold mb-1">R√¥le syst√®me</h3>
                        <p class="text-yellow-800 text-sm">
                            Ce r√¥le est essentiel au fonctionnement du syst√®me. Seul le nom d'affichage peut √™tre modifi√©.
                            Le nom technique et les autres param√®tres sont prot√©g√©s.
                        </p>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Formulaire -->
            <div class="max-w-3xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 fade-in">
                    <form method="POST" id="role-form">
                        {% csrf_token %}
                        
                        <!-- Erreurs globales -->
                        {% if form.non_field_errors %}
                            <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                                {% for error in form.non_field_errors %}
                                    <p class="text-sm text-red-600">{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                        
                        <!-- Nom technique -->
                        <div class="mb-6">
                            <label for="{{ form.name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                {{ form.name.label }} <span class="text-red-500">*</span>
                                {% if is_system_role %}
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 ml-2">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    Prot√©g√©
                                </span>
                                {% endif %}
                            </label>
                            {{ form.name }}
                            {% if form.name.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.name.errors.0 }}</p>
                            {% endif %}
                            <p class="mt-1 text-xs text-gray-500">{{ form.name.help_text }}</p>
                        </div>
                        
                        <!-- Nom d'affichage -->
                        <div class="mb-6">
                            <label for="{{ form.display_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                {{ form.display_name.label }} <span class="text-red-500">*</span>
                            </label>
                            {{ form.display_name }}
                            {% if form.display_name.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.display_name.errors.0 }}</p>
                            {% endif %}
                            <p class="mt-1 text-xs text-gray-500">{{ form.display_name.help_text }}</p>
                        </div>
                        
                        <!-- R√¥le par d√©faut -->
                        <div class="mb-8">
                            <div class="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                {{ form.is_default }}
                                <div>
                                    <label for="{{ form.is_default.id_for_label }}" class="text-sm font-medium text-gray-700 cursor-pointer">
                                        {{ form.is_default.label }}
                                    </label>
                                    <p class="text-xs text-gray-500 mt-1">{{ form.is_default.help_text }}</p>
                                    {% if form.is_default.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.is_default.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            
                            {% if is_edit %}
                            <div class="mt-3 p-3 bg-blue-50 rounded-lg">
                                <div class="flex items-start">
                                    <svg class="w-5 h-5 text-blue-600 mr-2 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <p class="text-xs text-blue-800">
                                        Si vous d√©finissez ce r√¥le comme r√¥le par d√©faut, tous les autres r√¥les perdront automatiquement ce statut.
                                        Les nouveaux utilisateurs recevront ce r√¥le lors de leur inscription.
                                    </p>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Boutons d'action -->
                        <div class="flex items-center justify-end gap-4 pt-6 border-t border-gray-200">
                            <a href="{% url 'manage_roles' %}" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-all">
                                Annuler
                            </a>
                            <button type="submit" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-all shadow-lg hover:shadow-xl flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                {% if is_edit %}Enregistrer les modifications{% else %}Cr√©er le r√¥le{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Menu mobile
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.querySelector('.sidebar-component');
        
        if (mobileMenuBtn && sidebar) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });
            
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }
    </script>
</body>
</html>

================================================================================
FILE: ./django_authentication/templates/admin/manage_roles.html
================================================================================

{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - AuthSystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        .main-content {
            margin-left: 256px;
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            .sidebar-component {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar-component.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .role-card {
            transition: all 0.3s ease;
        }
        
        .role-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    {% include 'components/sidebar.html' %}
    
    <!-- Bouton menu mobile -->
    <button id="mobile-menu-btn" class="md:hidden fixed top-4 left-4 z-30 p-2 bg-white rounded-lg shadow-lg">
        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
    
    <!-- Contenu principal -->
    <div class="main-content">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 sticky top-0 z-20">
            <div class="px-8 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">{{ page_title }}</h1>
                        <p class="text-gray-600 mt-1">G√©rez les r√¥les et permissions du syst√®me</p>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <!-- Bouton cr√©er r√¥le -->
                        <a href="{% url 'role_create' %}" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-all shadow-lg hover:shadow-xl flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Nouveau r√¥le
                        </a>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Contenu -->
        <main class="p-8">
            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                <div class="mb-6 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %} fade-in">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
            
            <!-- Section R√¥les Syst√®me -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-900">R√¥les syst√®me</h2>
                    <span class="text-sm text-gray-500">Non supprimables ‚Ä¢ Modification limit√©e</span>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for role in system_roles %}
                    <div class="role-card bg-white rounded-xl shadow-sm border-2 {% if role.name == 'superuser' %}border-purple-200{% else %}border-blue-200{% endif %} p-6">
                        <!-- En-t√™te -->
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 {% if role.name == 'superuser' %}bg-purple-100{% else %}bg-blue-100{% endif %} rounded-lg">
                                        <svg class="w-6 h-6 {% if role.name == 'superuser' %}text-purple-600{% else %}text-blue-600{% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            {% if role.name == 'superuser' %}
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                            {% else %}
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                            {% endif %}
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900">{{ role.display_name }}</h3>
                                        <p class="text-sm text-gray-500">Nom technique : <code class="bg-gray-100 px-2 py-0.5 rounded">{{ role.name }}</code></p>
                                    </div>
                                </div>
                                
                                {% if role.is_default %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    R√¥le par d√©faut
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Statistiques -->
                        <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Utilisateurs</span>
                                <span class="text-2xl font-bold {% if role.name == 'superuser' %}text-purple-600{% else %}text-blue-600{% endif %}">{{ role.user_count }}</span>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex items-center gap-2">
                            <a href="{% url 'role_edit' role.id %}" class="flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-all font-medium text-sm text-center">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                                Modifier
                            </a>
                            <button disabled class="px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed text-sm font-medium">
                                <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Section R√¥les Personnalis√©s -->
            <div>
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-900">R√¥les personnalis√©s</h2>
                    <span class="text-sm text-gray-500">{{ custom_roles.count }} r√¥le{{ custom_roles.count|pluralize }}</span>
                </div>
                
                {% if custom_roles %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for role in custom_roles %}
                    <div class="role-card bg-white rounded-xl shadow-sm border border-gray-200 p-6" data-role-id="{{ role.id }}">
                        <!-- En-t√™te -->
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg">
                                        <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900">{{ role.display_name }}</h3>
                                        <p class="text-sm text-gray-500"><code class="bg-gray-100 px-2 py-0.5 rounded">{{ role.name }}</code></p>
                                    </div>
                                </div>
                                
                                {% if role.is_default %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    R√¥le par d√©faut
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Statistiques -->
                        <div class="mb-4 p-4 bg-gradient-to-br from-gray-50 to-indigo-50 rounded-lg">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Utilisateurs</span>
                                <span class="text-2xl font-bold text-indigo-600">{{ role.user_count }}</span>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex items-center gap-2">
                            <a href="{% url 'role_edit' role.id %}" class="flex-1 px-4 py-2 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-lg transition-all font-medium text-sm text-center">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                                Modifier
                            </a>
                            <button 
                                onclick="confirmDeleteRole({{ role.id }}, '{{ role.display_name|escapejs }}', {{ role.user_count }})"
                                class="px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-all font-medium text-sm"
                                title="Supprimer">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center">
                    <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                    </svg>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Aucun r√¥le personnalis√©</h3>
                    <p class="text-gray-600 mb-6">Cr√©ez des r√¥les personnalis√©s pour mieux g√©rer les acteurs de votre syst√®me</p>
                    <a href="{% url 'role_create' %}" class="inline-flex items-center px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-all shadow-lg">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Cr√©er un r√¥le
                    </a>
                </div>
                {% endif %}
            </div>
        </main>
    </div>
    
    <!-- Toast de notification -->
    <div id="toast-notification" class="hidden fixed top-4 right-4 z-50">
        <div class="bg-white rounded-lg shadow-xl border border-gray-200 p-4 flex items-center gap-3 min-w-[300px] animate-slide-in">
            <div id="toast-icon" class="flex-shrink-0"></div>
            <div class="flex-1">
                <p id="toast-message" class="text-sm font-medium text-gray-900"></p>
            </div>
            <button type="button" id="close-toast-btn" class="flex-shrink-0 text-gray-400 hover:text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>
    
    <script src="{% static 'js/role-management.js' %}"></script>
    <script>
        // Menu mobile
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.querySelector('.sidebar-component');
        
        if (mobileMenuBtn && sidebar) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });
            
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }
    </script>
</body>
</html>

================================================================================
FILE: ./django_authentication/templates/admin/user_management.html
================================================================================

{% load static %}
{% load profile_tags %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - AuthSystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        .main-content {
            margin-left: 256px;
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            .sidebar-component {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar-component.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .table-row {
            transition: all 0.2s ease;
        }
        
        .table-row:hover {
            background-color: #f8fafc;
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    {% include 'components/sidebar.html' %}
    
    <!-- Bouton menu mobile -->
    <button id="mobile-menu-btn" class="md:hidden fixed top-4 left-4 z-30 p-2 bg-white rounded-lg shadow-lg">
        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
    
    <!-- Contenu principal -->
    <div class="main-content">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 sticky top-0 z-20">
            <div class="px-8 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">{{ page_title }}</h1>
                        <p class="text-gray-600 mt-1">G√©rez les comptes utilisateurs de votre organisation</p>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <!-- Bouton cr√©er utilisateur -->
                        <a href="{% url 'user_create' %}" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-all shadow-lg hover:shadow-xl flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Nouvel utilisateur
                        </a>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Contenu -->
        <main class="p-8">
            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                <div class="mb-6 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %} fade-in">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
            
            <!-- Barre de recherche et filtres -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6 fade-in">
                <form method="GET" action="{% url 'user_management' %}" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <!-- Recherche -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Recherche</label>
                        <input 
                            type="text" 
                            name="search" 
                            value="{{ search_query }}"
                            placeholder="Nom, email ou t√©l√©phone..."
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                        >
                    </div>
                    
                    <!-- Filtre r√¥le -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">R√¥le</label>
                        <select 
                            name="role" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                        >
                            <option value="">Tous les r√¥les</option>
                            {% for role in available_roles %}
                            <option value="{{ role.name }}" {% if role_filter == role.name %}selected{% endif %}>
                                {{ role.display_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Filtre statut -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Statut</label>
                        <select 
                            name="status" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                        >
                            <option value="">Tous les statuts</option>
                            <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Actifs</option>
                            <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>Inactifs</option>
                        </select>
                    </div>
                    
                    <!-- Boutons -->
                    <div class="flex items-end gap-2">
                        <button 
                            type="submit" 
                            class="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-all"
                        >
                            Appliquer
                        </button>
                        <a 
                            href="{% url 'user_management' %}?page=1" 
                            class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-all"
                        >
                            R√©initialiser
                        </a>
                    </div>
                </form>
            </div>
            
            <!-- Tableau des utilisateurs -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden fade-in">
                <!-- En-t√™te du tableau -->
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">
                            {{ page_obj.paginator.count }} utilisateur{{ page_obj.paginator.count|pluralize:"s" }}
                        </h3>
                        
                        <!-- Pagination -->
                        {% if page_obj.has_other_pages %}
                        <div class="flex items-center gap-2">
                            {% if page_obj.has_previous %}
                            <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query|urlencode }}{% endif %}{% if role_filter %}&role={{ role_filter|urlencode }}{% endif %}{% if status_filter %}&status={{ status_filter|urlencode }}{% endif %}" 
                               class="px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                                ‚Äπ
                            </a>
                            {% endif %}
                            
                            <span class="text-sm text-gray-600">
                                Page {{ page_obj.number }} sur {{ page_obj.paginator.num_pages }}
                            </span>
                            
                            {% if page_obj.has_next %}
                            <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query|urlencode }}{% endif %}{% if role_filter %}&role={{ role_filter|urlencode }}{% endif %}{% if status_filter %}&status={{ status_filter|urlencode }}{% endif %}" 
                               class="px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                                ‚Ä∫
                            </a>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Corps du tableau -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Utilisateur</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">R√¥le</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for user_obj in page_obj %}
                            <tr class="table-row" data-user-id="{{ user_obj.id }}">
                                <!-- Colonne Utilisateur -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-10 w-10">
                                            {% if user_obj|has_profile_picture %}
                                                <img class="h-10 w-10 rounded-full object-cover" src="{% profile_picture_url user_obj %}" alt="{{ user_obj.full_name }}">
                                            {% else %}
                                                <div class="h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm">
                                                    {{ user_obj.get_initials }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900">{{ user_obj.full_name }}</div>
                                            <div class="text-xs text-gray-500">ID: {{ user_obj.id }}</div>
                                        </div>
                                    </div>
                                </td>
                                
                                <!-- Colonne Contact -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">{{ user_obj.email }}</div>
                                    <div class="text-xs text-gray-500">{{ user_obj.phone }}</div>
                                </td>
                                
                                <!-- Colonne R√¥le -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                        {% if user_obj.role.name == 'superuser' %}bg-purple-100 text-purple-800
                                        {% else %}bg-blue-100 text-blue-800{% endif %}">
                                        {{ user_obj.role.display_name }}
                                    </span>
                                </td>
                                
                                <!-- Colonne Statut -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <button 
                                        onclick="toggleUserStatus({{ user_obj.id }}, {{ user_obj.is_active|lower }})"
                                        class="status-toggle px-3 py-1 text-xs font-semibold rounded-full transition-all 
                                            {% if user_obj.is_active %}bg-green-100 text-green-800 hover:bg-green-200
                                            {% else %}bg-red-100 text-red-800 hover:bg-red-200{% endif %}"
                                    >
                                        <span class="status-text-{{ user_obj.id }}">
                                            {{ user_obj.is_active|yesno:"Actif,Inactif" }}
                                        </span>
                                    </button>
                                </td>
                                
                                <!-- Colonne Date -->
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    {{ user_obj.created_at|date:"d/m/Y" }}
                                </td>
                                
                                <!-- Colonne Actions -->
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end gap-2">
                                        <!-- √âdition -->
                                        <a href="{% url 'user_edit' user_obj.id %}" 
                                           class="text-blue-600 hover:text-blue-900 transition-colors p-2 hover:bg-blue-50 rounded-lg"
                                           title="Modifier">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </a>
                                        
                                        <!-- Suppression -->
                                        <button 
                                            onclick="confirmDelete({{ user_obj.id }}, '{{ user_obj.full_name|escapejs }}')"
                                            class="text-red-600 hover:text-red-900 transition-colors p-2 hover:bg-red-50 rounded-lg"
                                            title="Supprimer">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                    <svg class="w-12 h-12 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                    </svg>
                                    <p class="mt-2 text-lg font-medium">Aucun utilisateur trouv√©</p>
                                    <p class="mt-1">Essayez de modifier vos crit√®res de recherche</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Toast de notification -->
    <div id="toast-notification" class="hidden fixed top-4 right-4 z-50">
        <div class="bg-white rounded-lg shadow-xl border border-gray-200 p-4 flex items-center gap-3 min-w-[300px] animate-slide-in">
            <div id="toast-icon" class="flex-shrink-0"></div>
            <div class="flex-1">
                <p id="toast-message" class="text-sm font-medium text-gray-900"></p>
            </div>
            <button type="button" id="close-toast-btn" class="flex-shrink-0 text-gray-400 hover:text-gray-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>
    
    <script src="{% static 'js/user-management.js' %}"></script>
    <script>
        // Menu mobile
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.querySelector('.sidebar-component');
        
        if (mobileMenuBtn && sidebar) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });
            
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }
        
        // Animation CSS pour le toast
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            .animate-slide-in { animation: slideIn 0.3s ease-out; }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>

================================================================================
FILE: ./django_authentication/templates/admin/user_list.html
================================================================================

{% load static %}
{% load profile_tags %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - AuthSystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        .main-content {
            margin-left: 256px;
            min-height: 100vh;
        }
        
        @media (max-width: 768px) {
            .sidebar-component {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar-component.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    {% include 'components/sidebar.html' %}
    
    <!-- Bouton menu mobile -->
    <button id="mobile-menu-btn" class="md:hidden fixed top-4 left-4 z-30 p-2 bg-white rounded-lg shadow-lg">
        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
    
    <!-- Contenu principal -->
    <div class="main-content">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 sticky top-0 z-20">
            <div class="px-8 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">{{ page_title }}</h1>
                        <p class="text-gray-600 mt-1">
                            {% if is_edit %}
                                Modifiez les informations de l'utilisateur
                            {% else %}
                                Cr√©ez un nouveau compte utilisateur
                            {% endif %}
                        </p>
                    </div>
                    
                    <a href="{% url 'user_management_list' %}" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-all flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Retour √† la liste
                    </a>
                </div>
            </div>
        </header>
        
        <!-- Contenu -->
        <main class="p-8">
            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                <div class="mb-6 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %} fade-in">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
            
            <!-- Formulaire -->
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 fade-in">
                    <form method="POST" enctype="multipart/form-data" id="user-form">
                        {% csrf_token %}
                        
                        <!-- Erreurs globales -->
                        {% if form.non_field_errors %}
                            <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                                {% for error in form.non_field_errors %}
                                    <p class="text-sm text-red-600">{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                        
                        <!-- Section Photo de profil -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Photo de profil</h3>
                            <div class="flex items-center gap-6">
                                <!-- Preview -->
                                <div class="relative">
                                    {% if is_edit and user_to_edit|has_profile_picture %}
                                        <img 
                                            id="profile-preview" 
                                            src="{% profile_picture_url user_to_edit %}" 
                                            alt="Preview"
                                            class="w-24 h-24 rounded-full object-cover ring-4 ring-gray-200"
                                        >
                                    {% else %}
                                        <div 
                                            id="profile-preview-initials" 
                                            class="w-24 h-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-2xl ring-4 ring-gray-200"
                                        >
                                            {% if is_edit %}{{ user_to_edit.get_initials }}{% else %}??{% endif %}
                                        </div>
                                        <img 
                                            id="profile-preview" 
                                            src="" 
                                            alt="Preview"
                                            class="w-24 h-24 rounded-full object-cover ring-4 ring-gray-200 hidden"
                                        >
                                    {% endif %}
                                </div>
                                
                                <!-- Actions -->
                                <div class="flex-1">
                                    {{ form.profile_picture }}
                                    <button 
                                        type="button"
                                        onclick="document.getElementById('id_profile_picture').click()"
                                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all font-medium text-sm"
                                    >
                                        Choisir une photo
                                    </button>
                                    <p class="text-xs text-gray-500 mt-2">JPG, PNG, GIF ou WEBP. Max 5MB.</p>
                                    {% if form.profile_picture.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.profile_picture.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section Informations personnelles -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Informations personnelles</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Nom complet -->
                                <div class="md:col-span-2">
                                    <label for="{{ form.full_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.full_name.label }} <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.full_name }}
                                    {% if form.full_name.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.full_name.errors.0 }}</p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">Format: Nom Pr√©nom, Nom_Pr√©nom ou NomPr√©nom</p>
                                </div>
                                
                                <!-- Email -->
                                <div>
                                    <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.email.label }} <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.email }}
                                    {% if form.email.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
                                    {% endif %}
                                </div>
                                
                                <!-- T√©l√©phone -->
                                <div>
                                    <label for="{{ form.phone.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.phone.label }} <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.phone }}
                                    {% if form.phone.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.phone.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section S√©curit√© -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">
                                {% if is_edit %}Modifier le mot de passe{% else %}Mot de passe{% endif %}
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Mot de passe -->
                                <div>
                                    <label for="{{ form.password.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.password.label }} {% if not is_edit %}<span class="text-red-500">*</span>{% endif %}
                                    </label>
                                    {{ form.password }}
                                    {% if form.password.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.password.errors.0 }}</p>
                                    {% endif %}
                                    {% if is_edit %}
                                        <p class="mt-1 text-xs text-gray-500">Laisser vide pour ne pas modifier</p>
                                    {% endif %}
                                </div>
                                
                                <!-- Confirmation -->
                                <div>
                                    <label for="{{ form.password_confirm.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.password_confirm.label }} {% if not is_edit %}<span class="text-red-500">*</span>{% endif %}
                                    </label>
                                    {{ form.password_confirm }}
                                    {% if form.password_confirm.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.password_confirm.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section R√¥le et Statut -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">R√¥le et statut</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- R√¥le -->
                                <div>
                                    <label for="{{ form.role.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ form.role.label }} <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.role }}
                                    {% if form.role.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.role.errors.0 }}</p>
                                    {% endif %}
                                    <p class="mt-1 text-xs text-gray-500">Superuser = acc√®s administrateur complet</p>
                                </div>
                                
                                <!-- Statut actif -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Statut du compte
                                    </label>
                                    <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg">
                                        {{ form.is_active }}
                                        <label for="{{ form.is_active.id_for_label }}" class="text-sm text-gray-700 cursor-pointer">
                                            Compte actif
                                        </label>
                                    </div>
                                    {% if form.is_active.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.is_active.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Boutons d'action -->
                        <div class="flex items-center justify-end gap-4 pt-6 border-t border-gray-200">
                            <a href="{% url 'user_management_list' %}" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-all">
                                Annuler
                            </a>
                            <button type="submit" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-all shadow-lg hover:shadow-xl flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                {% if is_edit %}Modifier{% else %}Cr√©er{% endif %} l'utilisateur
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Menu mobile
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.querySelector('.sidebar-component');
        
        if (mobileMenuBtn && sidebar) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });
            
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }
        
        // Pr√©visualisation de la photo
        const profilePictureInput = document.getElementById('id_profile_picture');
        const profilePreview = document.getElementById('profile-preview');
        const profilePreviewInitials = document.getElementById('profile-preview-initials');
        
        if (profilePictureInput) {
            profilePictureInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profilePreview.src = e.target.result;
                        profilePreview.classList.remove('hidden');
                        if (profilePreviewInitials) {
                            profilePreviewInitials.classList.add('hidden');
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    </script>
</body>
</html>

================================================================================


================================================================================
FILE: ./django_authentication/static/js/user-management.js
================================================================================

// Gestion des utilisateurs - Actions AJAX

// Toast de notification
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast-notification');
    const toastMessage = document.getElementById('toast-message');
    const toastIcon = document.getElementById('toast-icon');
    
    if (!toast || !toastMessage || !toastIcon) return;
    
    toastMessage.textContent = message;
    
    // Ic√¥ne selon le type
    if (type === 'success') {
        toastIcon.innerHTML = '<svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
    } else {
        toastIcon.innerHTML = '<svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
    }
    
    toast.classList.remove('hidden');
    
    // Ferme automatiquement apr√®s 5 secondes
    setTimeout(() => {
        toast.classList.add('hidden');
    }, 5000);
}

// Fermer le toast
document.addEventListener('DOMContentLoaded', function() {
    const closeToastBtn = document.getElementById('close-toast-btn');
    if (closeToastBtn) {
        closeToastBtn.addEventListener('click', () => {
            document.getElementById('toast-notification').classList.add('hidden');
        });
    }
});

// R√©cup√©rer le token CSRF
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Toggle statut utilisateur
function toggleUserStatus(userId, currentStatus) {
    if (!confirm('√ätes-vous s√ªr de vouloir modifier le statut de cet utilisateur ?')) {
        return;
    }
    
    const csrftoken = getCookie('csrftoken');
    
    fetch(`/admin/users/${userId}/toggle-status/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Met √† jour le bouton
            const statusButton = document.querySelector(`.status-toggle[data-user-id="${userId}"]`);
            const statusText = document.querySelector(`.status-text-${userId}`);
            
            if (statusButton && statusText) {
                if (data.is_active) {
                    statusButton.className = 'status-toggle px-3 py-1 text-xs font-semibold rounded-full transition-all bg-green-100 text-green-800 hover:bg-green-200';
                    statusText.textContent = 'Actif';
                } else {
                    statusButton.className = 'status-toggle px-3 py-1 text-xs font-semibold rounded-full transition-all bg-red-100 text-red-800 hover:bg-red-200';
                    statusText.textContent = 'Inactif';
                }
            }
            
            showToast(data.message, 'success');
        } else {
            showToast(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Erreur:', error);
        showToast('Erreur lors de la modification du statut', 'error');
    });
}

// Confirmer suppression
function confirmDelete(userId, userName) {
    if (confirm(`√ätes-vous s√ªr de vouloir supprimer l'utilisateur "${userName}" ?\n\nCette action est irr√©versible.`)) {
        deleteUser(userId, userName);
    }
}

// Supprimer utilisateur
function deleteUser(userId, userName) {
    const csrftoken = getCookie('csrftoken');
    
    fetch(`/admin/users/${userId}/delete/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Supprime la ligne du tableau
            const row = document.querySelector(`tr[data-user-id="${userId}"]`);
            if (row) {
                row.style.opacity = '0';
                row.style.transform = 'translateX(-20px)';
                setTimeout(() => {
                    row.remove();
                }, 300);
            }
            
            showToast(data.message, 'success');
            
            // Recharge la page apr√®s 2 secondes si plus aucun utilisateur
            setTimeout(() => {
                const tbody = document.querySelector('tbody');
                if (tbody && tbody.querySelectorAll('tr').length === 0) {
                    window.location.reload();
                }
            }, 2000);
        } else {
            showToast(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Erreur:', error);
        showToast('Erreur lors de la suppression', 'error');
    });
}

================================================================================
FILE: ./django_authentication/static/js/profile.js
================================================================================

// Gestion de la modale de profil et des mises √† jour AJAX

document.addEventListener('DOMContentLoaded', function() {
    // ==================== √âL√âMENTS DU DOM ====================
    
    // Modale
    const profileModal = document.getElementById('profile-modal');
    const editProfileBtn = document.getElementById('edit-profile-btn');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const cancelModalBtn = document.getElementById('cancel-modal-btn');
    
    // V√©rification que les √©l√©ments existent
    if (!profileModal || !editProfileBtn) {
        console.warn('Profile modal elements not found');
        return;
    }
    
    // Fonction utilitaire pour acc√©der en toute s√©curit√© aux propri√©t√©s des √©l√©ments
    function safeClassList(element, action, className) {
        if (!element || !element.classList) return;
        if (action === 'add' && className) {
            element.classList.add(className);
        } else if (action === 'remove' && className) {
            element.classList.remove(className);
        } else if (action === 'toggle' && className) {
            element.classList.toggle(className);
        }
    }
    
    // Formulaire
    const profileForm = document.getElementById('profile-form');
    const saveProfileBtn = document.getElementById('save-profile-btn');
    const saveText = document.getElementById('save-text');
    const saveLoader = document.getElementById('save-loader');
    
    // Champs du formulaire
    const fullNameInput = document.getElementById('modal-full-name');
    const emailInput = document.getElementById('modal-email');
    const phoneInput = document.getElementById('modal-phone');
    const profilePictureInput = document.getElementById('profile-picture-input');
    const uploadPhotoBtn = document.getElementById('upload-photo-btn');
    const deletePhotoBtn = document.getElementById('delete-photo-btn');
    
    // Pr√©visualisations
    let modalAvatarPreviewImg = document.getElementById('modal-avatar-preview-img');
    const modalAvatarPreviewInitials = document.getElementById('modal-avatar-preview-initials');
    const sidebarAvatarImg = document.getElementById('sidebar-avatar-img');
    const sidebarAvatarInitials = document.getElementById('sidebar-avatar-initials');
    const sidebarUserName = document.getElementById('sidebar-user-name');
    
    // Toast
    const toastNotification = document.getElementById('toast-notification');
    const toastMessage = document.getElementById('toast-message');
    const toastIcon = document.getElementById('toast-icon');
    const closeToastBtn = document.getElementById('close-toast-btn');
    
    // Variable pour stocker le fichier s√©lectionn√©
    let selectedFile = null;
    let deletePhoto = false;

    // ==================== GESTION DE LA MODALE ====================
    
    // Ouvrir la modale
    if (editProfileBtn) {
        editProfileBtn.addEventListener('click', function() {
            profileModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // R√©initialise les erreurs
            clearAllErrors();
        });
    }
    
    // Fermer la modale
    function closeModal() {
        profileModal.classList.add('hidden');
        document.body.style.overflow = 'auto';
        selectedFile = null;
        deletePhoto = false;
    }
    
    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', closeModal);
    }
    
    if (cancelModalBtn) {
        cancelModalBtn.addEventListener('click', closeModal);
    }
    
    // Fermer au clic sur le fond
    profileModal.addEventListener('click', function(e) {
        if (e.target === profileModal) {
            closeModal();
        }
    });
    
    // Fermer avec √âchap
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !profileModal.classList.contains('hidden')) {
            closeModal();
        }
    });

    // ==================== UPLOAD DE PHOTO ====================
    
    if (uploadPhotoBtn) {
        uploadPhotoBtn.addEventListener('click', function() {
            profilePictureInput.click();
        });
    }
    
    if (profilePictureInput) {
        profilePictureInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            
            if (file) {
                // Validation de la taille (5MB max)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('La taille de l\'image ne doit pas d√©passer 5MB', 'error');
                    profilePictureInput.value = '';
                    return;
                }
                
                // Validation du type
                const validTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/gif', 'image/webp'];
                if (!validTypes.includes(file.type)) {
                    showToast('Format non support√©. Utilisez JPG, PNG, GIF ou WEBP', 'error');
                    profilePictureInput.value = '';
                    return;
                }
                
                // Pr√©visualisation
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        // Mettre √† jour les r√©f√©rences aux √©l√©ments
                        modalAvatarPreviewImg = document.getElementById('modal-avatar-preview-img');
                        const previewInitials = document.getElementById('modal-avatar-preview-initials');
                        
                        // Mettre √† jour l'image de pr√©visualisation
                        if (modalAvatarPreviewImg) {
                            modalAvatarPreviewImg.src = e.target.result;
                            safeClassList(modalAvatarPreviewImg, 'remove', 'hidden');
                        }
                        
                        // Masquer les initiales
                        if (previewInitials) {
                            safeClassList(previewInitials, 'add', 'hidden');
                        }
                        
                        // Mettre √† jour le texte du bouton
                        if (uploadPhotoBtn) {
                            uploadPhotoBtn.innerHTML = `
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                Changer la photo
                            `;
                        }
                        
                        // Afficher le bouton de suppression
                        if (deletePhotoBtn) safeClassList(deletePhotoBtn, 'remove', 'hidden');
                    } catch (error) {
                        console.error('Erreur lors de la pr√©visualisation de l\'image :', error);
                    }
                };
                reader.readAsDataURL(file);
                
                selectedFile = file;
                deletePhoto = false;
            }
        });
    }

    // ==================== SUPPRESSION DE PHOTO ====================
    
    if (deletePhotoBtn) {
        deletePhotoBtn.addEventListener('click', function() {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer votre photo de profil ?')) {
                deletePhoto = true;
                selectedFile = null;
                if (profilePictureInput) profilePictureInput.value = '';
                
                // Affiche les initiales et masque l'image
                if (modalAvatarPreviewImg) safeClassList(modalAvatarPreviewImg, 'add', 'hidden');
                if (modalAvatarPreviewInitials) safeClassList(modalAvatarPreviewInitials, 'remove', 'hidden');
                
                // Mettre √† jour le texte du bouton
                if (uploadPhotoBtn) {
                    uploadPhotoBtn.innerHTML = `
                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        D√©finir la photo
                    `;
                }
                
                // Masquer le bouton de suppression
                if (deletePhotoBtn) safeClassList(deletePhotoBtn, 'add', 'hidden');
                
                // Ne pas appeler l'API ici, on attend la soumission du formulaire
            }
        });
    }
    
    function deleteProfilePicture() {
        fetch('/api/profile/delete-picture/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Met √† jour la sidebar
                if (sidebarAvatarImg) {
                    sidebarAvatarImg.remove();
                }
                
                if (sidebarAvatarInitials) {
                    sidebarAvatarInitials.classList.remove('hidden');
                    sidebarAvatarInitials.textContent = data.data.initials;
                } else {
                    // Cr√©e l'√©l√©ment initiales si n'existe pas
                    const initialsDiv = document.createElement('div');
                    initialsDiv.id = 'sidebar-avatar-initials';
                    initialsDiv.className = 'w-14 h-14 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-lg ring-2 ring-gray-200 transition-all group-hover:ring-blue-500';
                    initialsDiv.textContent = data.data.initials;
                    
                    const avatarContainer = document.querySelector('.sidebar-component .relative.group');
                    if (avatarContainer) {
                        avatarContainer.insertBefore(initialsDiv, avatarContainer.firstChild);
                    }
                }
                
                // Cache le bouton supprimer
                if (deletePhotoBtn) {
                    deletePhotoBtn.classList.add('hidden');
                }
                
                showToast(data.message, 'success');
            } else {
                showToast(data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Erreur:', error);
            showToast('Erreur lors de la suppression', 'error');
        });
    }

    // ==================== VALIDATION EN TEMPS R√âEL ====================
    
    if (fullNameInput) {
        fullNameInput.addEventListener('blur', function() {
            validateFullName(this.value);
        });
        
        fullNameInput.addEventListener('input', function() {
            clearError('full_name');
        });
    }
    
    if (emailInput) {
        emailInput.addEventListener('blur', function() {
            validateEmail(this.value);
        });
    }
    
    if (phoneInput) {
        phoneInput.addEventListener('input', function() {
            clearError('phone');
        });
    }
    
    function validateFullName(name) {
        // V√©rifie si le champ est vide
        if (!name || !name.trim()) {
            showError('full_name', 'Le nom complet est requis');
            return false;
        }
        
        // V√©rifie la longueur minimale
        if (name.trim().length < 2) {
            showError('full_name', 'Le nom complet doit contenir au moins 2 caract√®res');
            return false;
        }
        
        // V√©rifie le format du nom (plus permissif pour les caract√®res internationaux)
        const nameRegex = /^[\p{L}\s'-]+$/u;
        if (!nameRegex.test(name.trim())) {
            showError('full_name', 'Le nom contient des caract√®res non autoris√©s');
            return false;
        }
        
        // Si on arrive ici, la validation est r√©ussie
        clearError('full_name');
        return true;
    }
    
    function validateEmail(email) {
        // V√©rifie si le champ est vide
        if (!email || !email.trim()) {
            showError('email', 'L\'adresse e-mail est requise');
            return false;
        }
        
        // Expression r√©guli√®re plus permissive pour l'email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        if (!emailRegex.test(email.trim())) {
            showError('email', 'Veuillez entrer une adresse e-mail valide');
            return false;
        }
        
        // Si on arrive ici, la validation est r√©ussie
        clearError('email');
        return true;
    }
    
    function validatePhone(phone) {
        // Le t√©l√©phone est optionnel, donc si vide, c'est valide
        if (!phone || !phone.trim()) {
            clearError('phone');
            return true;
        }
        
        // Expression r√©guli√®re pour les num√©ros de t√©l√©phone internationaux
        const phoneRegex = /^[\+\d\s\(\)\-]+$/;
        
        if (!phoneRegex.test(phone.trim())) {
            showError('phone', 'Veuillez entrer un num√©ro de t√©l√©phone valide');
            return false;
        }
        
        // Si on arrive ici, la validation est r√©ussie
        clearError('phone');
        return true;
    }

    // ==================== SOUMISSION DU FORMULAIRE ====================
    
    if (profileForm) {
        profileForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('Soumission du formulaire d√©marr√©e');
            
            try {
                // Nettoyage des erreurs pr√©c√©dentes
                clearAllErrors();
                
                // Validation finale
                const fullNameValid = fullNameInput ? validateFullName(fullNameInput.value) : false;
                const emailValid = emailInput ? validateEmail(emailInput.value) : false;
                const phoneValid = phoneInput ? validatePhone(phoneInput.value) : true;
                
                if (!fullNameValid || !emailValid || !phoneValid) {
                    console.log('Validation √©chou√©e');
                    showToast('Veuillez corriger les erreurs dans le formulaire', 'error');
                    return;
                }
                
                // D√©sactive le bouton et affiche le loader
                saveProfileBtn.disabled = true;
                if (saveText) saveText.classList.add('hidden');
                if (saveLoader) saveLoader.classList.remove('hidden');
                
                // Pr√©pare les donn√©es
                const formData = new FormData();
                formData.append('full_name', fullNameInput ? fullNameInput.value.trim() : '');
                formData.append('email', emailInput ? emailInput.value.trim() : '');
                formData.append('phone', phoneInput ? phoneInput.value.trim() : '');
                
                // Ajoute un indicateur pour la suppression de la photo si n√©cessaire
                if (deletePhoto) {
                    formData.append('delete_picture', 'true');
                    console.log('Suppression de la photo demand√©e');
                }
                
                // Ajoute la nouvelle photo si s√©lectionn√©e
                if (selectedFile) {
                    formData.append('profile_picture', selectedFile);
                    console.log('Fichier s√©lectionn√©:', selectedFile.name);
                }
                
                // R√©cup√®re le token CSRF
                const csrftoken = getCookie('csrftoken');
                if (!csrftoken) {
                    console.error('CSRF token non trouv√©');
                    throw new Error('Erreur de s√©curit√©. Veuillez rafra√Æchir la page.');
                }
                
                console.log('Envoi de la requ√™te AJAX...');
                
                // Envoie la requ√™te AJAX
                const response = await fetch('/api/profile/update/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrftoken
                    },
                    body: formData,
                    credentials: 'same-origin'
                });
                
                console.log('R√©ponse re√ßue, statut:', response.status);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('Erreur de r√©ponse:', errorData);
                    
                    // Si nous avons des erreurs de validation, on les affiche
                    if (errorData.errors) {
                        return Promise.reject({ 
                            message: 'Erreur de validation', 
                            errors: errorData.errors 
                        });
                    }
                    
                    throw new Error(errorData.message || 'Erreur lors de la mise √† jour du profil');
                }
                
                const data = await response.json();
                console.log('Donn√©es re√ßues:', data);
                
                if (data.success) {
                    console.log('Mise √† jour r√©ussie, mise √† jour de l\'interface...');
                    // Met √† jour l'interface
                    if (data.data) {
                        updateUI(data.data);
                    }
                    
                    // Ferme la modale
                    closeModal();
                    
                    // Affiche le toast de succ√®s
                    showToast(data.message || 'Profil mis √† jour avec succ√®s', 'success');
                } else {
                    console.log('Erreurs de validation:', data.errors);
                    // Affiche les erreurs
                    if (data.errors) {
                        for (const field in data.errors) {
                            showError(field, data.errors[field]);
                        }
                    } else {
                        showToast(data.message || 'Une erreur est survenue', 'error');
                    }
                }
            } catch (error) {
                console.error('Erreur lors de la mise √† jour du profil:', error);
                
                // Affiche les erreurs de validation si elles existent
                if (error.errors) {
                    // R√©initialise d'abord toutes les erreurs
                    clearAllErrors();
                    
                    // Affiche chaque erreur de validation
                    for (const [field, message] of Object.entries(error.errors)) {
                        console.log(`Erreur sur le champ ${field}:`, message);
                        showError(field, message);
                    }
                    
                    // Affiche un message d'erreur g√©n√©ral
                    showToast('Veuillez corriger les erreurs dans le formulaire', 'error');
                } else {
                    // Pour les autres types d'erreurs, affiche simplement le message
                    showToast(error.message || 'Erreur lors de la mise √† jour du profil', 'error');
                }
            } finally {
                // R√©active le bouton
                if (saveProfileBtn) saveProfileBtn.disabled = false;
                if (saveText) saveText.classList.remove('hidden');
                if (saveLoader) saveLoader.classList.add('hidden');
            }
        });
    }

    // ==================== MISE √Ä JOUR DE L'INTERFACE ====================
    
    function updateUI(data) {
        // Met √† jour le nom dans la sidebar
        if (sidebarUserName) {
            sidebarUserName.textContent = data.full_name;
        }
        
        // Met √† jour l'image de profil dans la sidebar
        if (data.profile_picture_url) {
            if (sidebarAvatarImg) {
                sidebarAvatarImg.src = data.profile_picture_url;
                safeClassList(sidebarAvatarImg, 'remove', 'hidden');
                if (sidebarAvatarInitials) safeClassList(sidebarAvatarInitials, 'add', 'hidden');
            }
            // Mettre √† jour le texte du bouton
            if (uploadPhotoBtn) {
                uploadPhotoBtn.innerHTML = `
                    <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    Changer la photo
                `;
            }
            // Afficher le bouton de suppression
            if (deletePhotoBtn) safeClassList(deletePhotoBtn, 'remove', 'hidden');
        } else {
            if (sidebarAvatarImg) safeClassList(sidebarAvatarImg, 'add', 'hidden');
            if (sidebarAvatarInitials) {
                sidebarAvatarInitials.textContent = data.initials || '';
                safeClassList(sidebarAvatarInitials, 'remove', 'hidden');
            }
            // Mettre √† jour le texte du bouton
            if (uploadPhotoBtn) {
                uploadPhotoBtn.innerHTML = `
                    <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    D√©finir la photo
                `;
            }
            // Masquer le bouton de suppression
            if (deletePhotoBtn) safeClassList(deletePhotoBtn, 'add', 'hidden');
        }
        
        // Met √† jour les initiales dans la modale
        if (modalAvatarPreviewInitials) {
            modalAvatarPreviewInitials.textContent = data.initials;
        }
    }

    // ==================== GESTION DES ERREURS ====================
    
    function showError(field, message) {
        const errorElement = document.getElementById('error-' + field);
        const inputElement = document.getElementById('modal-' + field.replace('_', '-'));
        
        if (errorElement) {
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }
        
        if (inputElement) {
            inputElement.classList.add('border-red-500', 'focus:ring-red-500');
            inputElement.classList.remove('border-gray-300', 'focus:ring-blue-500');
        }
    }
    
    function clearError(field) {
        const errorElement = document.getElementById('error-' + field);
        const inputElement = document.getElementById('modal-' + field.replace('_', '-'));
        
        if (errorElement) {
            errorElement.textContent = '';
            errorElement.classList.add('hidden');
        }
        
        if (inputElement) {
            inputElement.classList.remove('border-red-500', 'focus:ring-red-500');
            inputElement.classList.add('border-gray-300', 'focus:ring-blue-500');
        }
    }
    
    function clearAllErrors() {
        clearError('full_name');
        clearError('email');
        clearError('phone');
    }

    // ==================== TOAST DE NOTIFICATION ====================
    
    function showToast(message, type) {
        if (!toastNotification || !toastMessage || !toastIcon) return;
        
        toastMessage.textContent = message;
        
        // Ic√¥ne selon le type
        if (type === 'success') {
            toastIcon.innerHTML = '<svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        } else {
            toastIcon.innerHTML = '<svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        }
        
        toastNotification.classList.remove('hidden');
        
        // Ferme automatiquement apr√®s 5 secondes
        setTimeout(function() {
            toastNotification.classList.add('hidden');
        }, 5000);
    }
    
    if (closeToastBtn) {
        closeToastBtn.addEventListener('click', function() {
            toastNotification.classList.add('hidden');
        });
    }

    // ==================== UTILITAIRES ====================
    
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});



================================================================================
FILE: ./django_authentication/static/js/role-management.js
================================================================================

// Gestion des r√¥les - Actions AJAX

// Toast de notification
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast-notification');
    const toastMessage = document.getElementById('toast-message');
    const toastIcon = document.getElementById('toast-icon');
    
    if (!toast || !toastMessage || !toastIcon) return;
    
    toastMessage.textContent = message;
    
    // Ic√¥ne selon le type
    if (type === 'success') {
        toastIcon.innerHTML = '<svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
    } else {
        toastIcon.innerHTML = '<svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
    }
    
    toast.classList.remove('hidden');
    
    // Ferme automatiquement apr√®s 5 secondes
    setTimeout(() => {
        toast.classList.add('hidden');
    }, 5000);
}

// Fermer le toast
document.addEventListener('DOMContentLoaded', function() {
    const closeToastBtn = document.getElementById('close-toast-btn');
    if (closeToastBtn) {
        closeToastBtn.addEventListener('click', () => {
            document.getElementById('toast-notification').classList.add('hidden');
        });
    }
});

// R√©cup√©rer le token CSRF
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Confirmer suppression de r√¥le
function confirmDeleteRole(roleId, roleName, userCount) {
    if (userCount > 0) {
        showToast(`Impossible de supprimer ce r√¥le. ${userCount} utilisateur(s) l'utilisent encore.`, 'error');
        return;
    }
    
    if (confirm(`√ätes-vous s√ªr de vouloir supprimer le r√¥le "${roleName}" ?\n\nCette action est irr√©versible.`)) {
        deleteRole(roleId, roleName);
    }
}

// Supprimer un r√¥le
function deleteRole(roleId, roleName) {
    const csrftoken = getCookie('csrftoken');
    
    fetch(`/gestion-roles/${roleId}/supprimer/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Supprime la card du DOM
            const card = document.querySelector(`[data-role-id="${roleId}"]`);
            if (card) {
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    card.remove();
                    
                    // Si plus aucun r√¥le personnalis√©, afficher le message vide
                    const customRolesGrid = card.parentElement;
                    if (customRolesGrid && customRolesGrid.children.length === 0) {
                        window.location.reload();
                    }
                }, 300);
            }
            
            showToast(data.message, 'success');
        } else {
            showToast(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Erreur:', error);
        showToast('Erreur lors de la suppression', 'error');
    });
}

// Animation CSS pour le toast
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    .animate-slide-in { animation: slideIn 0.3s ease-out; }
`;
document.head.appendChild(style);

================================================================================
FILE: ./django_authentication/static/js/signup.js
================================================================================

// Validation en temps r√©el et indicateur de robustesse du mot de passe

document.addEventListener('DOMContentLoaded', function() {
    // √âl√©ments du DOM
    const form = document.getElementById('signup-form');
    const passwordInput = document.getElementById('password');
    const passwordConfirmInput = document.getElementById('password_confirm');
    const acceptTermsCheckbox = document.getElementById('accept_terms');
    const submitBtn = document.getElementById('submit-btn');
    const submitText = document.getElementById('submit-text');
    const submitLoader = document.getElementById('submit-loader');
    
    // √âl√©ments de l'indicateur de robustesse
    const strengthBar = document.getElementById('strength-bar');
    const strengthText = document.getElementById('strength-text');
    const criteriaLength = document.getElementById('criteria-length');
    const criteriaUpper = document.getElementById('criteria-upper');
    const criteriaLower = document.getElementById('criteria-lower');
    const criteriaNumber = document.getElementById('criteria-number');
    const criteriaSpecial = document.getElementById('criteria-special');
    
    // √âl√©ments du s√©lecteur de pays
    const countrySelectorBtn = document.getElementById('country-selector-btn');
    const countryDropdown = document.getElementById('country-dropdown');
    const selectedCountrySpan = document.getElementById('selected-country');
    const countryCodeInput = document.getElementById('country_code');
    const countrySearch = document.getElementById('country-search');
    const countryOptions = document.querySelectorAll('.country-option');
    
    // Indicateur de correspondance des mots de passe
    const matchIndicator = document.getElementById('match-indicator');
    const matchIcon = document.getElementById('match-icon');

    // ==================== GESTION DU S√âLECTEUR DE PAYS ====================
    
    // Ouvrir/fermer le dropdown
    countrySelectorBtn.addEventListener('click', function(e) {
        e.preventDefault();
        countryDropdown.classList.toggle('hidden');
        countrySearch.value = '';
        filterCountries('');
    });

    // Fermer le dropdown si clic √† l'ext√©rieur
    document.addEventListener('click', function(e) {
        if (!countrySelectorBtn.contains(e.target) && !countryDropdown.contains(e.target)) {
            countryDropdown.classList.add('hidden');
        }
    });

    // Recherche de pays
    countrySearch.addEventListener('input', function() {
        filterCountries(this.value.toLowerCase());
    });

    function filterCountries(searchTerm) {
        countryOptions.forEach(option => {
            const countryName = option.textContent.toLowerCase();
            if (countryName.includes(searchTerm)) {
                option.style.display = 'flex';
            } else {
                option.style.display = 'none';
            }
        });
    }

    // S√©lection d'un pays
    countryOptions.forEach(option => {
        option.addEventListener('click', function() {
            const code = this.getAttribute('data-code');
            const flag = this.getAttribute('data-flag');
            
            selectedCountrySpan.innerHTML = '<span class="mr-1">' + flag + '</span><span>' + code + '</span>';
            countryCodeInput.value = code;
            countryDropdown.classList.add('hidden');
        });
    });

    // ==================== VALIDATION DU MOT DE PASSE ====================
    
    function checkPasswordStrength(password) {
        let strength = 0;
        const criteria = {
            length: password.length >= 8,
            upper: /[A-Z]/.test(password),
            lower: /[a-z]/.test(password),
            number: /\d/.test(password),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
        };

        // Mise √† jour des indicateurs visuels
        updateCriterion(criteriaLength, criteria.length);
        updateCriterion(criteriaUpper, criteria.upper);
        updateCriterion(criteriaLower, criteria.lower);
        updateCriterion(criteriaNumber, criteria.number);
        updateCriterion(criteriaSpecial, criteria.special);

        // Calcul de la force
        Object.values(criteria).forEach(function(met) {
            if (met) strength++;
        });

        // Bonus pour longueur suppl√©mentaire
        if (password.length >= 12) strength += 0.5;
        if (password.length >= 16) strength += 0.5;

        return {
            score: strength,
            criteria: criteria
        };
    }

    function updateCriterion(element, met) {
        if (met) {
            element.textContent = '‚úì';
            element.className = 'text-green-500 font-bold';
        } else {
            element.textContent = '‚óã';
            element.className = 'text-gray-400';
        }
    }

    function updateStrengthIndicator(strength) {
        const colors = {
            0: { color: 'bg-gray-300', width: '0%', text: '-', textColor: 'text-gray-500' },
            1: { color: 'bg-red-500', width: '20%', text: 'Tr√®s faible', textColor: 'text-red-500' },
            2: { color: 'bg-orange-500', width: '40%', text: 'Faible', textColor: 'text-orange-500' },
            3: { color: 'bg-yellow-500', width: '60%', text: 'Moyen', textColor: 'text-yellow-600' },
            4: { color: 'bg-lime-500', width: '80%', text: 'Fort', textColor: 'text-lime-600' },
            5: { color: 'bg-green-500', width: '100%', text: 'Tr√®s fort', textColor: 'text-green-600' },
            6: { color: 'bg-green-600', width: '100%', text: 'Robuste', textColor: 'text-green-700' }
        };

        const level = Math.min(Math.floor(strength), 6);
        const config = colors[level];

        strengthBar.className = 'password-strength-bar h-full rounded-full ' + config.color;
        strengthBar.style.width = config.width;
        strengthText.textContent = config.text;
        strengthText.className = 'text-xs font-medium ' + config.textColor;
    }

    passwordInput.addEventListener('input', function() {
        const password = this.value;
        
        if (password.length === 0) {
            updateStrengthIndicator(0);
            return;
        }

        const result = checkPasswordStrength(password);
        updateStrengthIndicator(result.score);
        
        // V√©rifier la correspondance si le champ de confirmation n'est pas vide
        checkPasswordMatch();
    });

    // ==================== VALIDATION DE LA CONFIRMATION ====================
    
    function checkPasswordMatch() {
        const password = passwordInput.value;
        const passwordConfirm = passwordConfirmInput.value;

        if (passwordConfirm.length === 0) {
            matchIndicator.classList.add('hidden');
            return;
        }

        matchIndicator.classList.remove('hidden');

        if (password === passwordConfirm) {
            matchIcon.textContent = '‚úì';
            matchIcon.className = 'text-green-500 text-xl font-bold';
        } else {
            matchIcon.textContent = '‚úó';
            matchIcon.className = 'text-red-500 text-xl font-bold';
        }
    }

    passwordConfirmInput.addEventListener('input', checkPasswordMatch);

    // ==================== ACTIVATION DU BOUTON ====================
    
    function updateSubmitButton() {
        if (acceptTermsCheckbox.checked) {
            submitBtn.disabled = false;
            submitBtn.classList.remove('bg-gray-400', 'cursor-not-allowed', 'opacity-50');
            submitBtn.classList.add('bg-blue-600', 'hover:bg-blue-700', 'cursor-pointer', 'shadow-lg', 'hover:shadow-xl', 'transform', 'hover:-translate-y-0.5');
        } else {
            submitBtn.disabled = true;
            submitBtn.classList.add('bg-gray-400', 'cursor-not-allowed', 'opacity-50');
            submitBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700', 'cursor-pointer', 'shadow-lg', 'hover:shadow-xl', 'transform', 'hover:-translate-y-0.5');
        }
    }

    acceptTermsCheckbox.addEventListener('change', updateSubmitButton);

    // ==================== SOUMISSION DU FORMULAIRE ====================
    
    form.addEventListener('submit', function() {
        if (!submitBtn.disabled) {
            submitText.classList.add('hidden');
            submitLoader.classList.remove('hidden');
            submitBtn.disabled = true;
            submitBtn.classList.add('cursor-wait');
        }
    });

    // ==================== VALIDATION EN TEMPS R√âEL DES AUTRES CHAMPS ====================
    
    const fullNameInput = document.getElementById('full_name');
    const emailInput = document.getElementById('email');

    // Validation du nom complet
    if (fullNameInput) {
        fullNameInput.addEventListener('blur', function() {
            const value = this.value.trim();
            const patterns = [
                /^[A-Za-z√Ä-√ø]+[\s_][A-Za-z√Ä-√ø]+[\s_]*[A-Za-z√Ä-√ø]*$/,
                /^[A-Z][a-z]+[A-Z][a-z]+[A-Z]*[a-z]*$/
            ];

            let isValid = false;
            for (let i = 0; i < patterns.length; i++) {
                if (patterns[i].test(value)) {
                    const segments = value.split(/[\s_]|(?=[A-Z])/).filter(function(s) { return s; });
                    if (segments.length >= 2) {
                        isValid = true;
                        break;
                    }
                }
            }

            if (value && !isValid) {
                showFieldError(this, 'Format invalide. Utilisez: "Nom Pr√©nom", "Nom_Pr√©nom" ou "NomPr√©nom"');
            } else {
                clearFieldError(this);
            }
        });
    }

    // Validation de l'email
    if (emailInput) {
        emailInput.addEventListener('blur', function() {
            const value = this.value.trim();
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

            if (value && !emailRegex.test(value)) {
                showFieldError(this, 'Format d\'adresse e-mail invalide');
            } else {
                clearFieldError(this);
            }
        });
    }

    function showFieldError(input, message) {
        clearFieldError(input);
        
        const errorDiv = document.createElement('p');
        errorDiv.className = 'mt-1 text-sm text-red-600 field-error';
        errorDiv.textContent = message;
        
        input.parentNode.appendChild(errorDiv);
        input.classList.add('border-red-500', 'focus:ring-red-500');
        input.classList.remove('border-gray-300', 'focus:ring-blue-500');
    }

    function clearFieldError(input) {
        const existingError = input.parentNode.querySelector('.field-error');
        if (existingError) {
            existingError.remove();
        }
        
        input.classList.remove('border-red-500', 'focus:ring-red-500');
        input.classList.add('border-gray-300', 'focus:ring-blue-500');
    }

    // Initialisation
    updateSubmitButton();
});




================================================================================
FILE: ./django_authentication/static/js/superuser-dashboard.js
================================================================================

// Gestion du tableau de bord superuser - Statistiques en temps r√©el

document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Tableau de bord superuser initialis√©');
    
    // √âl√©ments du DOM
    const refreshBtn = document.getElementById('refresh-stats-btn');
    const lastUpdateTime = document.getElementById('last-update-time');
    
    // √âl√©ments de statistiques
    const statElements = {
        total: document.getElementById('stat-total'),
        users: document.getElementById('stat-users'),
        superusers: document.getElementById('stat-superusers'),
        active: document.getElementById('stat-active'),
        inactive: document.getElementById('stat-inactive')
    };
    
    // √âtat de chargement
    let isLoading = false;
    
    // ==================== ACTUALISATION DES STATISTIQUES ====================
    
    async function refreshStats() {
        if (isLoading) return;
        
        isLoading = true;
        
        // Animation de rotation du bouton
        if (refreshBtn) {
            refreshBtn.classList.add('animate-spin');
            refreshBtn.disabled = true;
        }
        
        try {
            // Simulation d'actualisation (√† remplacer par un vrai appel API si n√©cessaire)
            // Pour l'instant, on recharge simplement la page
            window.location.reload();
            
        } catch (error) {
            console.error('‚ùå Erreur lors de l\'actualisation:', error);
            showNotification('Erreur lors de l\'actualisation des statistiques', 'error');
        } finally {
            isLoading = false;
            
            // Arr√™t de l'animation
            if (refreshBtn) {
                setTimeout(() => {
                    refreshBtn.classList.remove('animate-spin');
                    refreshBtn.disabled = false;
                }, 500);
            }
        }
    }
    
    // ==================== ANIMATION DES CHIFFRES ====================
    
    function animateValue(element, start, end, duration) {
        if (!element) return;
        
        const range = end - start;
        const increment = range / (duration / 16); // 60 FPS
        let current = start;
        
        const timer = setInterval(() => {
            current += increment;
            if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                current = end;
                clearInterval(timer);
                
                // Effet de pulsation
                element.parentElement.classList.add('scale-110');
                setTimeout(() => {
                    element.parentElement.classList.remove('scale-110');
                }, 200);
            }
            element.textContent = Math.round(current);
        }, 16);
    }
    
    // Animation au chargement
    Object.values(statElements).forEach(element => {
        if (element) {
            const finalValue = parseInt(element.textContent);
            element.textContent = '0';
            setTimeout(() => {
                animateValue(element, 0, finalValue, 1000);
            }, 100);
        }
    });
    
    // ==================== NOTIFICATION TOAST ====================
    
    function showNotification(message, type = 'success') {
        // Cr√©ation du toast
        const toast = document.createElement('div');
        toast.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-xl transform transition-all duration-300 ${
            type === 'success' ? 'bg-green-500' : 'bg-red-500'
        } text-white flex items-center gap-3`;
        
        toast.innerHTML = `
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                ${type === 'success' 
                    ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>'
                    : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>'
                }
            </svg>
            <span class="font-medium">${message}</span>
        `;
        
        document.body.appendChild(toast);
        
        // Animation d'entr√©e
        setTimeout(() => {
            toast.style.transform = 'translateX(0)';
        }, 10);
        
        // Suppression automatique apr√®s 3 secondes
        setTimeout(() => {
            toast.style.transform = 'translateX(400px)';
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 300);
        }, 3000);
    }
    
    // ==================== EVENT LISTENERS ====================
    
    // Bouton d'actualisation
    if (refreshBtn) {
        refreshBtn.addEventListener('click', refreshStats);
    }
    
    // Actualisation automatique toutes les 30 secondes (optionnel)
    // D√©commentez si vous souhaitez une actualisation automatique
    /*
    setInterval(() => {
        console.log('üîÑ Actualisation automatique des statistiques...');
        refreshStats();
    }, 30000);
    */
    
    // ==================== EFFETS VISUELS SUPPL√âMENTAIRES ====================
    
    // Effet de survol sur les cartes de statistiques
    const statCards = document.querySelectorAll('.stat-card');
    statCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
    
    console.log('‚úÖ Tableau de bord superuser pr√™t');
});

================================================================================
FILE: ./django_authentication/static/js/login.js
================================================================================

// Validation frontend et am√©lioration UX pour la connexion

document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('login-form');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const submitBtn = document.getElementById('submit-btn');
    const submitText = document.getElementById('submit-text');
    const submitLoader = document.getElementById('submit-loader');
    const togglePasswordBtn = document.getElementById('toggle-password');
    const eyeOpen = document.getElementById('eye-open');
    const eyeClosed = document.getElementById('eye-closed');

    // ==================== AFFICHER/MASQUER MOT DE PASSE ====================
    
    if (togglePasswordBtn) {
        togglePasswordBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeOpen.classList.add('hidden');
                eyeClosed.classList.remove('hidden');
            } else {
                passwordInput.type = 'password';
                eyeOpen.classList.remove('hidden');
                eyeClosed.classList.add('hidden');
            }
        });
    }

    // ==================== VALIDATION EN TEMPS R√âEL ====================
    
    // Validation de l'email
    if (emailInput) {
        emailInput.addEventListener('blur', function() {
            const value = this.value.trim();
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

            if (value && !emailRegex.test(value)) {
                showFieldError(this, 'Format d\'adresse e-mail invalide');
            } else {
                clearFieldError(this);
            }
        });

        emailInput.addEventListener('input', function() {
            clearFieldError(this);
        });
    }

    // Validation du mot de passe
    if (passwordInput) {
        passwordInput.addEventListener('input', function() {
            clearFieldError(this);
        });
    }

    // ==================== SOUMISSION DU FORMULAIRE ====================
    
    if (form) {
        form.addEventListener('submit', function(e) {
            let isValid = true;

            // Validation de l'email
            if (emailInput) {
                const email = emailInput.value.trim();
                const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

                if (!email) {
                    showFieldError(emailInput, 'L\'adresse e-mail est obligatoire');
                    isValid = false;
                } else if (!emailRegex.test(email)) {
                    showFieldError(emailInput, 'Format d\'adresse e-mail invalide');
                    isValid = false;
                }
            }

            // Validation du mot de passe
            if (passwordInput) {
                const password = passwordInput.value;

                if (!password) {
                    showFieldError(passwordInput, 'Le mot de passe est obligatoire');
                    isValid = false;
                }
            }

            if (!isValid) {
                e.preventDefault();
                return false;
            }

            // Affichage du loader
            if (submitBtn && !submitBtn.disabled) {
                submitText.classList.add('hidden');
                submitLoader.classList.remove('hidden');
                submitBtn.disabled = true;
                submitBtn.classList.add('cursor-wait', 'opacity-75');
            }
        });
    }

    // ==================== FONCTIONS UTILITAIRES ====================
    
    function showFieldError(input, message) {
        clearFieldError(input);
        
        const errorDiv = document.createElement('p');
        errorDiv.className = 'mt-1 text-sm text-red-600 field-error';
        errorDiv.textContent = message;
        
        const parent = input.parentNode;
        if (parent.classList.contains('relative')) {
            parent.parentNode.appendChild(errorDiv);
        } else {
            parent.appendChild(errorDiv);
        }
        
        input.classList.add('border-red-500', 'focus:ring-red-500');
        input.classList.remove('border-gray-300', 'focus:ring-blue-500');
    }

    function clearFieldError(input) {
        const parent = input.parentNode;
        const errorElement = parent.classList.contains('relative') 
            ? parent.parentNode.querySelector('.field-error')
            : parent.querySelector('.field-error');
        
        if (errorElement) {
            errorElement.remove();
        }
        
        input.classList.remove('border-red-500', 'focus:ring-red-500');
        input.classList.add('border-gray-300', 'focus:ring-blue-500');
    }

    // ==================== AUTO-FOCUS SUR LE PREMIER CHAMP ====================
    
    if (emailInput && !emailInput.value) {
        emailInput.focus();
    }
});


================================================================================
FILE: ./django_authentication/static/images/default-avatar.svg
================================================================================

================================================================================

<?xml version="1.0" encoding="UTF-8"?>
<svg width="200" height="200" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="200" height="200" rx="100" fill="#E5E7EB"/>
    <path d="M100 60C85.6 60 74 71.6 74 86C74 100.4 85.6 112 100 112C114.4 112 126 100.4 126 86C126 71.6 114.4 60 100 60ZM100 104C90 104 82 96 82 86C82 76 90 68 100 68C110 68 118 76 118 86C118 96 110 104 100 104Z" fill="#6B7280"/>
    <path d="M100 120C71.2 120 48 143.2 48 172C48 175.2 50.4 178 54 178C57.6 178 60 175.6 60 172C60 151.6 76.8 134.8 96.8 132.8L100 132.6L103.2 132.8C123.2 134.8 140 151.6 140 172C140 175.2 142.4 178 146 178C149.6 178 152 175.6 152 172C152 143.2 128.8 120 100 120Z" fill="#6B7280"/>
</svg>


================================================================================


================================================================================
FILE: ./django_authentication/management/commands/createsuperuser.py
================================================================================

from django.core.management.base import BaseCommand
from django.core.exceptions import ValidationError
from django_authentication.models import User
import getpass
import re

class Command(BaseCommand):
    help = 'Cr√©e un superutilisateur avec role="superuser"'

    def add_arguments(self, parser):
        parser.add_argument('--email', type=str, help='Adresse email')
        parser.add_argument('--full-name', type=str, help='Nom complet')
        parser.add_argument('--phone', type=str, help='Num√©ro de t√©l√©phone')

    def handle(self, *args, **options):
        self.stdout.write(self.style.SUCCESS('=== Cr√©ation d\'un superutilisateur ===\n'))

        # R√©cup√©rer l'email
        email = options.get('email')
        while not email:
            email = input('Adresse e-mail: ').strip().lower()
            if not re.match(r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$', email):
                self.stdout.write(self.style.ERROR('Format d\'email invalide'))
                email = None
            elif User.objects.filter(email=email).exists():
                self.stdout.write(self.style.ERROR('Cet email existe d√©j√†'))
                email = None

        # R√©cup√©rer le nom complet
        full_name = options.get('full_name')
        while not full_name:
            full_name = input('Nom complet (ex: Dupont Jean): ').strip()
            is_valid, normalized = User.validate_full_name(full_name)
            if not is_valid:
                self.stdout.write(self.style.ERROR('Format de nom invalide'))
                full_name = None
            else:
                full_name = normalized

        # R√©cup√©rer le t√©l√©phone
        phone = options.get('phone')
        while not phone:
            phone = input('Num√©ro de t√©l√©phone: ').strip()
            if User.objects.filter(phone=phone).exists():
                self.stdout.write(self.style.ERROR('Ce num√©ro existe d√©j√†'))
                phone = None

        # R√©cup√©rer le mot de passe
        password = None
        while not password:
            password = getpass.getpass('Mot de passe: ')
            password_confirm = getpass.getpass('Confirmer le mot de passe: ')
            
            if password != password_confirm:
                self.stdout.write(self.style.ERROR('Les mots de passe ne correspondent pas'))
                password = None
                continue
            
            if len(password) < 8:
                self.stdout.write(self.style.ERROR('Le mot de passe doit contenir au moins 8 caract√®res'))
                password = None

        try:
            # Cr√©er le superuser
            user = User.objects.create_superuser(
                email=email,
                full_name=full_name,
                phone=phone,
                password=password
            )
            
            self.stdout.write(self.style.SUCCESS(f'\n‚úì Superutilisateur cr√©√© avec succ√®s!'))
            self.stdout.write(self.style.SUCCESS(f'  Email: {user.email}'))
            self.stdout.write(self.style.SUCCESS(f'  R√¥le: {user.role}'))
            self.stdout.write(self.style.SUCCESS(f'  ID: {user.id}\n'))
            
        except Exception as e:
            self.stdout.write(self.style.ERROR(f'\n‚úó Erreur: {str(e)}\n'))



================================================================================
FILE: ./django_authentication/management/commands/__init__.py
================================================================================

================================================================================



================================================================================


================================================================================
FILE: ./authentication/asgi.py
================================================================================

"""
ASGI config for authentication project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "authentication.settings")

application = get_asgi_application()



================================================================================
FILE: ./authentication/urls.py
================================================================================

from django.contrib import admin
from django.urls import path, include
from django.contrib.auth import views as auth_views
from django.conf import settings
from django.conf.urls.static import static
from django.views.generic import RedirectView

# URLs personnalis√©es pour l'administration
admin_site_urls = [
    # Inclure d'abord les URLs personnalis√©es
    path('users/', include('django_authentication.urls')),
    # Puis les URLs de l'admin standard
    path('', admin.site.urls),
]

urlpatterns = [
    # URLs de l'administration avec nos personnalisations
    path('admin/', include(admin_site_urls)),
    # Autres URLs de l'application
    path('', include('django_authentication.urls')),
]

# Servir les fichiers m√©dia en d√©veloppement
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
    urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)



================================================================================
FILE: ./authentication/wsgi.py
================================================================================

"""
WSGI config for authentication project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "authentication.settings")

application = get_wsgi_application()



================================================================================
FILE: ./authentication/__init__.py
================================================================================




================================================================================
FILE: ./authentication/settings.py
================================================================================

"""
Django settings for authentication project.

Generated by 'django-admin startproject' using Django 5.2.8.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

import os
from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = "django-insecure-_ghg8w#^+&r6xvct%bw#*c+vv&9ejwv77m3q^funn!yj5ydll&"

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ['127.0.0.1', 'localhost']


# Application definition

INSTALLED_APPS = [
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    "django_authentication",
]

MIDDLEWARE = [
    "django.middleware.security.SecurityMiddleware",
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "django.middleware.clickjacking.XFrameOptionsMiddleware",
]

ROOT_URLCONF = "authentication.urls"

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [],
        "APP_DIRS": True,
        "OPTIONS": {
            "context_processors": [
                "django.template.context_processors.debug",
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
            ],
        },
    },
]

WSGI_APPLICATION = "authentication.wsgi.application"

# Custom user model
AUTH_USER_MODEL = 'django_authentication.User'

# Authentication backends
AUTHENTICATION_BACKENDS = [
    'django_authentication.backends.CustomAuthBackend',
    'django.contrib.auth.backends.ModelBackend',
]

# Login/Logout URLs
LOGIN_URL = 'login'
# La redirection sera g√©r√©e par la vue de connexion
LOGIN_REDIRECT_URL = 'user_dashboard'  # URL par d√©faut si la redirection personnalis√©e √©choue
LOGOUT_REDIRECT_URL = 'login'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.sqlite3",
        "NAME": BASE_DIR / "db.sqlite3",
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        "NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.MinimumLengthValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.CommonPasswordValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.NumericPasswordValidator",
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = "fr-fr"

TIME_ZONE = "Africa/Porto-Novo"

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = "/static/"
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'django_authentication', 'static'),
    os.path.join(BASE_DIR, 'django_authentication', 'static', 'images'),
]
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')

# Configuration des fichiers m√©dias
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

# Configuration des messages Django
from django.contrib.messages import constants as messages

MESSAGE_TAGS = {
    messages.DEBUG: 'debug',
    messages.INFO: 'info',
    messages.SUCCESS: 'success',
    messages.WARNING: 'warning',
    messages.ERROR: 'error',
}

# S√©curit√© (pour la production, ajuster ces param√®tres)
SECURE_BROWSER_XSS_FILTER = True
SECURE_CONTENT_TYPE_NOSNIFF = True
X_FRAME_OPTIONS = 'DENY'

# Validation des mots de passe
AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
        'OPTIONS': {
            'min_length': 8,
        }
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]

# Redirection apr√®s connexion/d√©connexion
LOGIN_URL = '/login/'
LOGIN_REDIRECT_URL = '/user-interface/'
LOGOUT_REDIRECT_URL = '/login/'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = "django.db.models.BigAutoField"

# Configuration du mod√®le utilisateur personnalis√©
AUTH_USER_MODEL = 'django_authentication.User'

# Configuration des sessions
# Configuration des sessions
SESSION_ENGINE = 'django.contrib.sessions.backends.db'
SESSION_COOKIE_NAME = 'auth_sessionid'
SESSION_COOKIE_AGE = 1209600  # 2 semaines
SESSION_SAVE_EVERY_REQUEST = False
SESSION_COOKIE_HTTPONLY = True

# Utilisation du s√©rialiseur personnalis√© pour les sessions
SESSION_SERIALIZER = 'django_authentication.session_serializer.CustomSessionSerializer'
SESSION_COOKIE_SECURE = False  # Mettre True en production avec HTTPS
SESSION_COOKIE_SAMESITE = 'Lax'

# Configuration du cache (pour throttling)
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',
        'LOCATION': 'unique-snowflake',
        'TIMEOUT': 300,
        'OPTIONS': {
            'MAX_ENTRIES': 1000
        }
    }
}

# S√©curit√© des mots de passe
PASSWORD_HASHERS = [
    'django.contrib.auth.hashers.PBKDF2PasswordHasher',
    'django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher',
    'django.contrib.auth.hashers.Argon2PasswordHasher',
    'django.contrib.auth.hashers.BCryptSHA256PasswordHasher',
]

# Configuration des fichiers m√©dia (uploads)
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

# Taille maximale des uploads (5MB)
FILE_UPLOAD_MAX_MEMORY_SIZE = 5242880  # 5MB en bytes
DATA_UPLOAD_MAX_MEMORY_SIZE = 5242880  # 5MB en bytes

# D√©finir le mod√®le User personnalis√©
AUTH_USER_MODEL = 'django_authentication.User'

# Backend d'authentification personnalis√©
AUTHENTICATION_BACKENDS = [
    'django.contrib.auth.backends.ModelBackend',
]